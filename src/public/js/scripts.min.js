const URL="http://192.168.0.10:3333/api",category=(()=>{const e=$("#dataTable").DataTable(),t=(t,o)=>{r(o).then(r=>(e.row($(t.closest("tr"))).remove().draw(),Swal.fire({title:`Categoria ${r.name} removida com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:e,text:"Ocorreu um erro ao remover a categoria",icon:"error",confirmButtonText:"Ok"}))},r=e=>new Promise((t,r)=>{const o=document.body.dataset.token;fetch(`/api/category/${e}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${o}`}}).then(e=>e.ok?e.json():r("Erro ao deletar categoria")).then(e=>t(e)).catch(e=>r(e))}),o=e=>(e=>{const r=e.dataset.id;e.addEventListener("click",o=>(o.preventDefault(),t(e,r)))})(e),n=t=>{t.addEventListener("click",r=>{const o=t.dataset.id,n=document.querySelector(".btnEditCategory");return(e=>new Promise((t,r)=>{const o=document.body.dataset.token;fetch(`/api/category/${e}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${o}`}}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(o).then(t=>{const r=document.querySelector(".editCategoryName"),o=document.querySelector(".editCategoryDescription"),a=document.querySelector(".editCategorySlug"),s=document.querySelector(".editCategoryParent"),{id:i,name:c,description:d,slug:l,parent:u}=t;return s.querySelector(`option[value="${u}"]`)&&(s.querySelector(`option[value="${u}"]`).selected=!0),r.value=c,o.value=d,a.value=l,n.addEventListener("click",t=>(e=>new Promise((t,r)=>{const o=document.body.dataset.token,{id:n,name:a,description:s,slug:i,parent:c}=e;fetch(`/api/category/${n}`,{method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({name:a,description:s,slug:i,parent:c})}).then(e=>e.ok?e.json():r("Erro ao criar categoria")).then(e=>t(e)).catch(e=>r(e))}))({id:i,name:r.value,description:o.value,slug:a.value,parent:s.value||null}).then(t=>(t=>{const{id:r,name:o,description:n,slug:a,parent:s,createdAt:i}=t,c=document.querySelector(`.category-${r}`);if(c){c.querySelector("td:nth-child(2)"),c.querySelector("td:nth-child(3)"),c.querySelector("td:nth-child(5)");let t=new Date(i);t=new Intl.DateTimeFormat("pt-BR").format(t);let r=e.row($(c)).data();return console.log(c),r[1]=o,r[2]=n,e.row($(c)).data(r).draw(),Swal.fire({title:`Categoria ${o} editada com sucesso!`,icon:"success",confirmButtonText:"Ok"})}})(t)))}).catch(e=>Swal.fire({title:"Erro ao editar categoria",icon:"error",confirmButtonText:"Ok"}))})};return{destroy:o,create:t=>{t.addEventListener("click",t=>{t.preventDefault();const r=document.querySelector(".categoryName"),a=document.querySelector(".categoryDescription"),s=document.querySelector(".categorySlug"),i=document.querySelector(".categoryParent");return(e=>new Promise((t,r)=>{e.map(e=>{const{input:o,msg:n}=e;return console.log(),o.value&&"Selecione..."!=o.value?t():(o.setCustomValidity(n),o.reportValidity(),r(n))})}))([{input:r,msg:"Informe um nome para a categoria"}]).then(()=>(e=>new Promise((t,r)=>{const o=document.body.dataset.token,{name:n,description:a,slug:s,parent:i}=e;fetch("/api/category",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({name:n,description:a,slug:s,parent:i})}).then(e=>e.json()).then(e=>{if(e.error)return r(e.error);t(e)}).catch(e=>r(e))}))({name:r.value,description:a.value,slug:s.value,parent:i.value||null}).then(t=>((t=>{const{id:r,name:a,description:s,createdAt:i}=t;let c=new Date(i);c=new Intl.DateTimeFormat("pt-BR").format(c);const d=e.row.add([r,a,s,0,`\x3c!-- Botão de ação Editar // --\x3e\n            <button type="button" class="btn btn-datatable btn-icon btn-transparent-dark editCategory py-0" data-toggle="modal" data-target="#modalEditCategory" data-id="${r}">\n                <i class="fas fa-edit"></i>\n            </button>\n            \x3c!-- Botão de ação Editar // --\x3e\n            <button type="button" class="btn btn-datatable btn-icon btn-transparent-dark categoryDestroy py-0" data-id="${r}">\n                <i class="far fa-trash-alt"></i>\n            </button>`]).draw().node();d.classList.add(`category-${r}`);const l=d.querySelector(".editCategory");n(l);const u=d.querySelector(".categoryDestroy");o(u)})(t),Swal.fire({title:`Categoria ${t.name} criada com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))})},edit:n}})(),btnCategoryDestroy=document.querySelectorAll(".categoryDestroy");btnCategoryDestroy&&Array.from(btnCategoryDestroy).forEach(e=>category.destroy(e));const btnModalEditCategory=document.querySelectorAll(".editCategory");btnModalEditCategory&&Array.from(btnModalEditCategory).forEach(e=>category.edit(e));const btnCreateCategory=document.querySelector(".btnCreateCategory");btnCreateCategory&&category.create(btnCreateCategory);const loginResource="login",requestLogin=e=>new Promise((t,r)=>{const{email:o,password:n,gToken:a}=e;fetch("/api/login",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:o,password:n,gToken:a})}).then(e=>e.json()).then(e=>e.error?r(e.error):(t(e),console.log(e))).catch(e=>r(e))}),login=e=>{const t=e.querySelector(".loginMail"),r=e.querySelector(".loginPassword");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),r.value?void grecaptcha.ready(function(){grecaptcha.execute("6LeM9q0ZAAAAAPJ827IgGMXdYRB9NdnNkbfrmaEY",{action:"login"}).then(function(o){return requestLogin({email:t.value,password:r.value,gToken:o}).then(e=>{window.location.href="/dashboard"}).catch(t=>{const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t,e.prepend(r),setTimeout(()=>{r.remove()},4e3)})})}):r.classList.add("is-invalid")):t.classList.add("is-invalid")},btnLogin=document.querySelector(".btnLogin");btnLogin&&btnLogin.addEventListener("click",e=>{e.preventDefault(),login(btnLogin.closest("form"))});const btnsProduct=document.querySelectorAll(".productDelete"),requestDeleteProduct=e=>new Promise((t,r)=>{const o=document.body.dataset.token;fetch(`/api/product/${e}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${o}`}}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))});btnsProduct&&Array.from(btnsProduct).forEach(e=>{e.addEventListener("click",t=>{const r=e.dataset.product;requestDeleteProduct(r).then(t=>(e.closest(".col-12").remove(),Swal.fire({title:"Produto excluido com sucesso!",text:`O produto ${t.name} foi excluído`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Arro ao remover produto",text:e,icon:"error",confirmButtonText:"Ok"}))})});const productResource="product";let codesInsert=[],productImages=[];const imgProduct=(()=>{const e=[],t=[];let r=0;const o=e=>{e.addEventListener("click",t=>{const o=e.dataset.index;return allImages=e.closest(".imagesProductContainer").querySelectorAll("img"),Array.from(allImages).forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),r=parseInt(o),console.log(r)})};return{create:()=>new Promise(async(o,n)=>{const a=document.body.dataset.token,s=e.map(async e=>{const r=new FormData;return r.append("file",e),e=await fetch("/api/image/product",{method:"POST",headers:{authorization:`Bearer ${a}`},body:r}).then(e=>e.json()).then(e=>e.error?n(e.error):(t.push(e.id),e)).catch(e=>n(e)),await e}),i=await Promise.all(s);return i[r].default=!0,console.log("Resultado retornado: ",i),o(i)}),change:t=>{t.addEventListener("change",r=>{r.preventDefault();const n=document.querySelector(".imagesProductContainer"),a=[...t.files];t.closest(".custom-file").querySelector("label").innerHTML=a.length+" imagens",console.log("Lista de imagens",a),a.map(t=>{const r=document.createElement("div");r.classList.add("mb-2","col-sm-3"),r.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const a=r.querySelector("img");if(FileReader&&t){var s=new FileReader;return s.onload=function(){a.src=s.result},s.readAsDataURL(t),e.push(t),a.dataset.index=e.indexOf(t),1===e.length&&a.classList.add("active"),o(a),n.append(r)}})})},images:t,default:o}})(),clearListItems=()=>{codesInsert=[];const e=document.querySelectorAll(".colapseCodes > div > .row > div");if(e)return Array.from(e).forEach(e=>{if(e)return e.remove()}),document.querySelector(".headerListItem span.badge,badge-primary").innerHTML=codesInsert.length},putSpinnet=(e,t)=>{const r=document.createElement("div");return r.classList.add("spinner-border","text-primary","float-right"),r.setAttribute("role","status"),r.innerHTML='<span class="sr-only">Loading...</span>',"insert"===t?e.append(r):"remove"===t&&e.querySelector(".spinner-border")?e.querySelector(".spinner-border").remove():void 0},changeBadgeForm=e=>{const t=document.querySelector(".colapseCodes"),r=t.closest(".accordion").querySelector(".card-header .badge");if(t)return r.innerHTML=e},removeCodeForm=e=>{e.addEventListener("click",t=>{const r=e.dataset.code,o=codesInsert.find(e=>e.code===r);if(o){let t=codesInsert.indexOf(o);return codesInsert.splice(t,1),e.closest(".col-12").remove(),changeBadgeForm(codesInsert.length)}console.log("código não esta presente")})},checkCodeInList=e=>!codesInsert.find(t=>t.code===e),createItem=e=>{const{prefix:t,code:r}=e,o=document.createElement("div");return o.classList.add("col-12","mb-3"),o.innerHTML=`\n    <div class="card">\n        <div class="card-header">\n            ${t}\n            <button type="button" class="float-right btn btn-danger btn-sm" data-code="${r}"><i class="fas fa-trash-alt"></i></button>\n        </div>\n        <div class="card-body">\n        ${r}\n        </div>\n    </div>\n    `,removeCodeForm(o.querySelector("button")),o},formValidate=e=>new Promise((t,r)=>{if("object"!=typeof e)return r("O parametro deve ser um array");const o=e.filter(e=>{if(!e.value)return e});return t({valids:e.filter(e=>{if(e.value)return e}),invalids:o})}),insertSingleCode=e=>{e.addEventListener("click",t=>{if(t.preventDefault(),e.disabled)return!1;const r=e.closest("form");putSpinnet(r,"insert");const o=r.querySelector(".productItemName"),n=r.querySelector(".productCode");return formValidate([o,n]).then(e=>{const{valids:t,invalids:a}=e;if(a.length)return a.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")});if(!checkCodeInList(n.value))return putSpinnet(r,"remove"),Swal.fire({title:"O Código duplicado",text:`O Código ${n.value} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:n.value,name:o.value});const s=createItem({prefix:o.value,code:n.value}),i=document.querySelector(".colapseCodes");return i?(i.querySelector(".card-body > .row").append(s),changeBadgeForm(codesInsert.length),putSpinnet(r,"remove"),i.classList.add("show")):void 0})})},changeFileProduct=e=>{e.addEventListener("change",t=>{const r=e.value.split(/(\\|\/)/g).pop();e.closest(".custom-file").querySelector("label").innerHTML=r;const o=document.querySelector(".productItemName");return putSpinnet(o.closest("form"),"insert"),formValidate([o]).then(t=>{const{invalids:r,valids:n}=t;return r.length?(putSpinnet(o.closest("form"),"remove"),e.value="",r.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")})):readFile(e.files[0]).then(e=>{const r=document.querySelector(".colapseCodes");r&&r.classList.add("show");const{invalids:n,valids:a}=t;return a.map(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")}),e.map(e=>{const t=createItem({prefix:o.value,code:e.text});if(!checkCodeInList(e.text))return putSpinnet(o.closest("form"),"remove"),Swal.fire({title:"O Código duplicado",text:`O Código ${e.text} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:e.text,name:o.value}),changeBadgeForm(codesInsert.length),r.querySelector(".card-body > .row").append(t)}),putSpinnet(o.closest("form"),"remove")}).catch(e=>(putSpinnet(o.closest("form"),"remove"),Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"})))})})},readFile=e=>new Promise((t,r)=>{const o=document.body.dataset.token,n=new FormData;n.append("file",e);const{type:a}=e;if("text/plain"!=a)return r("O tipo de arquivo deve ser .txt"),Swal.fire({title:"O tipo de arquivo deve ser .txt",text:"Selecione um arquivo com extensão txt",icon:"error",confirmButtonText:"Ok"});fetch("/api/file",{method:"POST",headers:{authorization:`Bearer ${o}`},body:n}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}),requestInsertProduct=e=>new Promise((t,r)=>{const{name:o,description:n,weight:a,brand:s,lot:i,type:c,availability:d,items:l,image_id:u,categories:m}=e,p=document.body.dataset.token;if(!m.length)return r("Selecione ao menos 1 categoria");fetch("/api/product",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${p}`},body:JSON.stringify({name:o,description:n,weight:a,brand:s,lot:i,type:c,categories:m,availability:d,items:l,image_id:u})}).then(e=>e.json()).then(e=>e.error?r(e.error.replace(/(\r\n|\n|\r)/gm,"<br>")):(t(e),console.log(e))).catch(e=>r(e))}),productCreate=e=>{const t=e.querySelector(".productName"),r=e.querySelector(".productDescription"),o=e.querySelector(".productWeigth"),n=e.querySelector(".productBrand"),a=e.querySelector(".productLot"),s=e.querySelector(".productType"),i=e.querySelector(".productAvailability"),c=document.querySelector(".productItemName"),d=document.querySelector(".multCodes"),l=document.querySelector(".productCode"),u=document.querySelector(".fileToRead"),m=(imgProduct.images,document.querySelectorAll(".productCategory"));let p=[];if(m&&Array.from(m).forEach(e=>{e.checked&&p.push(parseInt(e.value))}),!p.length)return Swal.fire({title:"Selecione a categoria",text:"Por favor selecione ao menos 1 categoria",icon:"error",confirmButtonText:"Ok"});console.log("Categorias",p),e.classList.add("was-validated"),putSpinnet(e.closest("form"),"insert");const v=[t,o,n,a,s,i,c];return d.checked?v.push(u):v.push(l),formValidate(v).then(c=>{const{valids:d,invalids:l}=c;return l.length&&(putSpinnet(e.closest("form"),"remove"),l.forEach(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")})),codesInsert.length?(d.forEach(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")}),imgProduct.create().then(c=>requestInsertProduct({name:t.value,description:r.value,weight:o.value,brand:n.value,lot:a.value,type:s.value,availability:i.value,items:codesInsert,categories:p,image_id:c}).then(t=>{if(t.error){const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t.error,e.prepend(r),setTimeout(()=>{r.remove()},4e3)}const r=e.querySelectorAll("input, textarea, .is-valid");return e.classList.remove("was-validated"),Array.from(r).forEach(e=>(e.value="",e.classList.remove("is-valid"))),putSpinnet(e.closest("form"),"remove"),Swal.fire({title:"Produto cadastrado",text:`O produto ${t.name} foi cadastrado com sucesso`,icon:"success",confirmButtonText:"Ok"})}).catch(t=>{const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t,e.prepend(r),putSpinnet(e.closest("form"),"remove"),setTimeout(()=>{r.remove()},4e3)}))):(putSpinnet(e.closest("form"),"remove"),Swal.fire({title:"Nenhum item cadastrado",text:"Por favor ensira ao menos 1 item no produto",icon:"error",confirmButtonText:"Ok"}))}).catch(e=>{console.log(e)})},btnInsertProduct=document.querySelector(".btnInsertProduct");btnInsertProduct&&btnInsertProduct.addEventListener("click",e=>{e.preventDefault(),productCreate(btnInsertProduct.closest("form"))});const switchMultCodes=document.querySelector(".multCodes");switchMultCodes&&switchMultCodes.addEventListener("change",function(e){!0===switchMultCodes.checked?(document.querySelector(".form-items-codes .custom-file-wrapper").classList.add("show"),document.querySelector(".form-items-codes .singleCode").classList.add("hide"),document.querySelector(".btnInsertItemProduct").disabled=!0):(document.querySelector(".form-items-codes .custom-file-wrapper").classList.remove("show"),document.querySelector(".form-items-codes .singleCode").classList.remove("hide"),document.querySelector(".btnInsertItemProduct").disabled=!1)}),btnClearCodes=document.querySelector(".btnCleamListProduct"),btnClearCodes&&btnClearCodes.addEventListener("click",e=>(e.preventDefault(),clearListItems()));const inputFileProduct=document.querySelector(".fileToRead");inputFileProduct&&changeFileProduct(inputFileProduct);const btnInsertItemProduct=document.querySelector(".btnInsertItemProduct");btnInsertItemProduct&&insertSingleCode(btnInsertItemProduct);const ImageProduct=document.querySelector(".productImage");ImageProduct&&imgProduct.change(ImageProduct);const profile=(()=>{const e=e=>(console.log(e.files),(e=>new Promise((t,r)=>{const o=document.body.dataset.token,n=new FormData;n.append("file",e),fetch("/api/user/image",{method:"PUT",headers:{authorization:`Bearer ${o}`},body:n}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(e.files[0]).then(e=>e.error?console.log(e.error):(document.querySelector(".img-profile").src=e.url,document.querySelector(".profile-avatar").src=e.url)).catch(e=>console.log(e))),t=e=>{if(!e)return console.log("Formulário não existe");Array.from(e.elements);const t={name:e.querySelector("#input-username").value,email:e.querySelector("#input-email").value,currentPassword:e.querySelector("#input-current-password").value,newPassword:e.querySelector("#input-new-password").value,address:e.querySelector("#input-address").value,city:e.querySelector("#input-city").value,phone:e.querySelector("#input-phone").value,cell:e.querySelector("#input-cell").value,about:e.querySelector("#textarea-about").value};return(e=>new Promise((t,r)=>{const o=document.body.dataset.token,{name:n,email:a,phone:s,cell:i,currentPassword:c,newPassword:d,address:l,about:u,city:m}=e;fetch("/api/user",{method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({name:n,email:a,phone:s,cell:i,currentPassword:c,newPassword:d,address:l,about:u,city:m})}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(t).then(e=>e.error?Swal.fire({title:"Erro ao atualizar usuário",text:e.error,icon:"error",confirmButtonText:"Ok"}):Swal.fire({title:"Perfil atualizado",text:`O Usuário ${e.name} foi atualizado com sucesso!`,icon:"success",confirmButtonText:"Ok"})).catch(e=>Swal.fire({title:"Erro ao atualizar usuário",text:e,icon:"error",confirmButtonText:"Ok"}))};return{edit:t=>{t.addEventListener("change",function(r){e(t)})},enableEdit:e=>{e||console.log("Botão não existe"),e.addEventListener("click",r=>{r.preventDefault();const o=document.querySelectorAll(".formEditUser input, .formEditUser textarea"),n=document.querySelector(".formEditUser");return e.classList.contains("save")?(Array.from(o).forEach(e=>{e.disabled=!0}),e.innerHTML="Edit profile",n&&t(n),e.classList.remove("save")):(Array.from(o).forEach(e=>{e.disabled=!1}),e.innerHTML="Salvar alterações",e.classList.add("save"))})},save:t}})(),inputEditAvatar=document.querySelector(".inputProfileAvatar");inputEditAvatar&&profile.edit(inputEditAvatar);const btnEditUser=document.querySelector(".btnEditUser");btnEditUser&&profile.enableEdit(btnEditUser);const search=(()=>{const e=()=>new Promise((e,t)=>{fetch("https://ipapi.co/json/",{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.ok?e.json():t("Erro ao pesquisar codigo")).then(t=>e(t)).catch(e=>t(e))}),t=e=>new Promise((t,r)=>{const{name:o,surname:n,email:a,code:s,ip:i,city:c,region:d}=e;fetch("/api/search",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:o,surname:n,email:a,code:s,ip:i,city:c,region:d})}).then(e=>e.json()).then(e=>(console.log(e),e.error?r(e.error):t(e))).catch(e=>r(e))});return{search:r=>{r.addEventListener("click",r=>{r.preventDefault(),console.log();const o=document.querySelector("input.Code"),n=document.querySelector("input.name"),a=document.querySelector("input.surname"),s=document.querySelector("input.mail");if(n&&a&&s)return(e=>new Promise((t,r)=>{e.map(e=>{const{input:o,msg:n}=e;return o.value?t():(o.setCustomValidity(n),o.reportValidity(),r(n))})}))([{input:n,msg:"Informe seu nome"},{input:a,msg:"Informe seu sobrenome"},{input:s,msg:"Informe seu e-mail"}]).then(r=>e().then(e=>{const{ip:r,city:i,region:c}=e;return t({code:o.value,ip:r,city:i,region:c,name:n.value,surname:a.value,email:s.value}).then(e=>{const{device:t,code:r,ip:o,city:n,address:a}=e;return document.querySelector(".clientInfo").innerHTML=`\n                                <p>\n                                    <strong>Código: </strong> ${r.code}\n                                </p>\n                                <p>\n                                    <strong>Produto: </strong> ${r.product.name}\n                                </p>\n                                <p>\n                                    <strong>Item: </strong> ${r.item.name}\n                                </p>\n                                <p>\n                                    <strong>Device: </strong> ${t}\n                                </p>\n                                <p>\n                                    <strong>Cidade: </strong> ${n}\n                                </p>\n                                <p>\n                                    <strong>Estado: </strong> ${a}\n                                </p>\n                                <p>\n                                    <strong>Endereço IP: </strong> ${o}\n                                </p>\n                            `}).catch(e=>Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"}))})).catch(e=>console.log(e))})}}})(),btnSearchCode=document.querySelector(".submitSearch");btnSearchCode&&search.search(btnSearchCode);const userResource="user",user={forgot:e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector("#input-forgot-email");t&&(e=>new Promise((t,r)=>{fetch("/api/forgot",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:e})}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(t.value).then(e=>e.erro?alert(e.erro):window.location.href="/login").catch(e=>console.log(e))})}},btnForgot=document.querySelector(".btnForgot");btnForgot&&user.forgot(btnForgot);const requestInsertAvatar=e=>new Promise((t,r)=>{const o=document.body.dataset.token,n=new FormData;n.append("file",e);fetch("/api/user/image",{method:"POST",headers:{authorization:`Bearer ${o}`},body:n}).then(e=>e.json()).then(e=>(console.log(e),t(e)))}),requestInsertUser=e=>new Promise((t,r)=>{const{name:o,email:n,password:a,phone:s,cell:i,type:c,image_id:d}=e,l=document.body.dataset.token;fetch("/api/user",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${l}`},body:JSON.stringify({name:o,email:n,password:a,phone:s,cell:i,type:c,image_id:d})}).then(e=>e.json()).then(e=>e.error?r(e.error):(t(e),console.log(e))).catch(e=>r(e))}),userCreate=e=>{const t=e.querySelector("input.userName"),r=e.querySelector(".userMail"),o=e.querySelector(".userPhone"),n=e.querySelector(".userCell"),a=e.querySelector(".userType"),s=e.querySelector(".userPassword"),i=e.querySelector(".inputUserImage");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),r.value?(r.classList.remove("is-invalid"),r.classList.add("is-valid"),o.value?(o.classList.remove("is-invalid"),o.classList.add("is-valid"),n.value?(n.classList.remove("is-invalid"),n.classList.add("is-valid"),s.value?(s.classList.remove("is-invalid"),s.classList.add("is-valid"),a.value?(a.classList.remove("is-invalid"),a.classList.add("is-valid"),requestInsertUser({name:t.value,email:r.value,phone:o.value,cell:n.value,type:a.value,password:s.value,image_id:i.value}).then(t=>{if(t.error){const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t.error,e.prepend(r),setTimeout(()=>{r.remove()},4e3)}const r=e.querySelectorAll("input, textarea, .is-valid");return e.classList.remove("was-validated"),Array.from(r).forEach(e=>(e.value="",e.classList.remove("is-valid"))),alert(`Usuário ${t.name} cadastrado!`)}).catch(t=>{const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t,e.prepend(r),setTimeout(()=>{r.remove()},4e3)})):a.classList.add("is-invalid")):s.classList.add("is-invalid")):n.classList.add("is-invalid")):o.classList.add("is-invalid")):r.classList.add("is-invalid")):t.classList.add("is-invalid")},inputImageUser=document.querySelector(".userFile");inputImageUser&&inputImageUser.addEventListener("change",e=>(console.log(inputImageUser.files[0]),requestInsertAvatar(inputImageUser.files[0]).then(e=>{document.querySelector(".insertUserAvatar").setAttribute("src",e.url),document.querySelector(".inputUserImage").value=e.id})));const btnInsertUser=document.querySelector(".btnCreateUser");btnInsertUser&&btnInsertUser.addEventListener("click",e=>{e.preventDefault(),userCreate(btnInsertUser.closest("form"))});