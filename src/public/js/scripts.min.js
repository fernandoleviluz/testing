const URL="http://192.168.0.10:3333/api",loginResource="login",requestLogin=e=>new Promise((t,s)=>{const{email:r,password:o}=e;fetch("/api/login",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:r,password:o})}).then(e=>e.json()).then(e=>e.error?s(e.error):(t(e),console.log(e))).catch(e=>s(e))}),login=e=>{const t=e.querySelector(".loginMail"),s=e.querySelector(".loginPassword");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),s.value?requestLogin({email:t.value,password:s.value}).then(e=>{window.location.href="/dashboard"}).catch(t=>{const s=document.createElement("div");s.classList.add("alert","alert-danger"),s.setAttribute("role","alert"),s.innerHTML=t,e.prepend(s),setTimeout(()=>{s.remove()},4e3)}):s.classList.add("is-invalid")):t.classList.add("is-invalid")},btnLogin=document.querySelector(".btnLogin");btnLogin&&btnLogin.addEventListener("click",e=>{e.preventDefault(),login(btnLogin.closest("form"))});const productResource="product";let codesInsert=[];const changeBadgeForm=e=>{const t=document.querySelector(".colapseCodes"),s=t.closest(".accordion").querySelector(".card-header .badge");if(t)return s.innerHTML=e},removeCodeForm=e=>{e.addEventListener("click",t=>{const s=e.dataset.code,r=codesInsert.find(e=>e.code===s);if(r){let t=codesInsert.indexOf(r);return codesInsert.splice(t,1),e.closest(".col-12").remove(),changeBadgeForm(codesInsert.length)}console.log("código não esta presente")})},checkCodeInList=e=>!codesInsert.find(t=>t.code===e),createItem=e=>{const{prefix:t,code:s}=e,r=document.createElement("div");return r.classList.add("col-12","mb-3"),r.innerHTML=`\n    <div class="card">\n        <div class="card-header">\n            ${t}\n            <button type="button" class="float-right btn btn-danger btn-sm" data-code="${s}"><i class="fas fa-trash-alt"></i></button>\n        </div>\n        <div class="card-body">\n        ${s}\n        </div>\n    </div>\n    `,removeCodeForm(r.querySelector("button")),r},formValidate=e=>new Promise((t,s)=>{if("object"!=typeof e)return s("O parametro deve ser um array");const r=e.filter(e=>{if(!e.value)return e});return t({valids:e.filter(e=>{if(e.value)return e}),invalids:r})}),insertSingleCode=e=>{e.addEventListener("click",t=>{if(t.preventDefault(),e.disabled)return!1;const s=e.closest("form"),r=s.querySelector(".productItemName"),o=s.querySelector(".productCode");return formValidate([r,o]).then(e=>{const{valids:t,invalids:s}=e;if(s.length)return s.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")});if(!checkCodeInList(o.value))return Swal.fire({title:"O Código duplicado",text:`O Código ${o.value} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:o.value,name:r.value});const a=createItem({prefix:r.value,code:o.value}),i=document.querySelector(".colapseCodes");return i?(i.querySelector(".card-body > .row").append(a),changeBadgeForm(codesInsert.length),i.classList.add("show")):void 0})})},changeFileProduct=e=>{e.addEventListener("change",t=>{const s=e.value.split(/(\\|\/)/g).pop();e.closest(".custom-file").querySelector("label").innerHTML=s;const r=document.querySelector(".productItemName");return formValidate([r]).then(t=>{const{invalids:s,valids:o}=t;return s.length?(e.value="",s.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")})):readFile(e.files[0]).then(e=>{const s=document.querySelector(".colapseCodes");s&&s.classList.add("show");const{invalids:o,valids:a}=t;return a.map(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")}),e.map(e=>{const t=createItem({prefix:r.value,code:e.text});if(!checkCodeInList(e.text))return Swal.fire({title:"O Código duplicado",text:`O Código ${e.text} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:e.text,name:r.value}),changeBadgeForm(codesInsert.length),s.querySelector(".card-body > .row").append(t)})}).catch(e=>console.log(e))})})},readFile=e=>new Promise((t,s)=>{const r=document.body.dataset.token,o=new FormData;o.append("file",e);const{type:a}=e;if("text/plain"!=a)return Swal.fire({title:"O tipo de arquivo deve ser .txt",text:"Selecione um arquivo com extensão txt",icon:"error",confirmButtonText:"Ok"});fetch("/api/file",{method:"POST",headers:{authorization:`Bearer ${r}`},body:o}).then(e=>e.json()).then(e=>t(e)).catch(e=>s(e))}),requestInsertProduct=e=>new Promise((t,s)=>{const{name:r,description:o,weight:a,lot:i,type:n,availability:d}=e,c=document.body.dataset.token;fetch("/api/product",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${c}`},body:JSON.stringify({name:r,description:o,weight:a,lot:i,type:n,availability:d})}).then(e=>e.json()).then(e=>e.error?s(e.error):(t(e),console.log(e))).catch(e=>s(e))}),productCreate=e=>{const t=e.querySelector(".productName"),s=(e.querySelector(".productDescription"),e.querySelector(".productWeigth")),r=e.querySelector(".productLot"),o=e.querySelector(".productType"),a=e.querySelector(".productAvailability"),i=document.querySelector(".productItemName"),n=document.querySelector(".multCodes"),d=document.querySelector(".productCode"),c=document.querySelector(".fileToRead");e.classList.add("was-validated");const l=[t,s,r,o,a,i];return n.checked?l.push(c):l.push(d),formValidate(l).then(e=>{const{valids:t,invalids:s}=e;console.log("Invalidos: ",s,"Validos: ",t),s.forEach(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")}),t.forEach(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")})}).catch(e=>{console.log(e)})},btnInsertProduct=document.querySelector(".btnInsertProduct");btnInsertProduct&&btnInsertProduct.addEventListener("click",e=>{e.preventDefault(),productCreate(btnInsertProduct.closest("form"))});const switchMultCodes=document.querySelector(".multCodes");switchMultCodes&&switchMultCodes.addEventListener("change",function(e){!0===switchMultCodes.checked?(document.querySelector(".form-items-codes .custom-file-wrapper").classList.add("show"),document.querySelector(".form-items-codes .singleCode").classList.add("hide"),document.querySelector(".btnInsertItemProduct").disabled=!0):(document.querySelector(".form-items-codes .custom-file-wrapper").classList.remove("show"),document.querySelector(".form-items-codes .singleCode").classList.remove("hide"),document.querySelector(".btnInsertItemProduct").disabled=!1)});const inputFileProduct=document.querySelector(".fileToRead");inputFileProduct&&changeFileProduct(inputFileProduct);const btnInsertItemProduct=document.querySelector(".btnInsertItemProduct");btnInsertItemProduct&&insertSingleCode(btnInsertItemProduct);const userResource="user",requestInsertAvatar=e=>new Promise((t,s)=>{const r=document.body.dataset.token,o=new FormData;o.append("file",e);fetch("/api/user/image",{method:"POST",headers:{authorization:`Bearer ${r}`},body:o}).then(e=>e.json()).then(e=>(console.log(e),t(e)))}),requestInsertUser=e=>new Promise((t,s)=>{const{name:r,email:o,password:a,phone:i,cell:n,type:d,image_id:c}=e,l=document.body.dataset.token;fetch("/api/user",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${l}`},body:JSON.stringify({name:r,email:o,password:a,phone:i,cell:n,type:d,image_id:c})}).then(e=>e.json()).then(e=>e.error?s(e.error):(t(e),console.log(e))).catch(e=>s(e))}),userCreate=e=>{const t=e.querySelector("input.userName"),s=e.querySelector(".userMail"),r=e.querySelector(".userPhone"),o=e.querySelector(".userCell"),a=e.querySelector(".userType"),i=e.querySelector(".userPassword"),n=e.querySelector(".inputUserImage");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),s.value?(s.classList.remove("is-invalid"),s.classList.add("is-valid"),r.value?(r.classList.remove("is-invalid"),r.classList.add("is-valid"),o.value?(o.classList.remove("is-invalid"),o.classList.add("is-valid"),i.value?(i.classList.remove("is-invalid"),i.classList.add("is-valid"),a.value?(a.classList.remove("is-invalid"),a.classList.add("is-valid"),requestInsertUser({name:t.value,email:s.value,phone:r.value,cell:o.value,type:a.value,password:i.value,image_id:n.value}).then(t=>{if(t.error){const s=document.createElement("div");s.classList.add("alert","alert-danger"),s.setAttribute("role","alert"),s.innerHTML=t.error,e.prepend(s),setTimeout(()=>{s.remove()},4e3)}const s=e.querySelectorAll("input, textarea, .is-valid");return e.classList.remove("was-validated"),Array.from(s).forEach(e=>(e.value="",e.classList.remove("is-valid"))),alert(`Usuário ${t.name} cadastrado!`)}).catch(t=>{const s=document.createElement("div");s.classList.add("alert","alert-danger"),s.setAttribute("role","alert"),s.innerHTML=t,e.prepend(s),setTimeout(()=>{s.remove()},4e3)})):a.classList.add("is-invalid")):i.classList.add("is-invalid")):o.classList.add("is-invalid")):r.classList.add("is-invalid")):s.classList.add("is-invalid")):t.classList.add("is-invalid")},inputImageUser=document.querySelector(".userFile");inputImageUser&&inputImageUser.addEventListener("change",e=>(console.log(inputImageUser.files[0]),requestInsertAvatar(inputImageUser.files[0]).then(e=>{document.querySelector(".insertUserAvatar").setAttribute("src",e.url),document.querySelector(".inputUserImage").value=e.id})));const btnInsertUser=document.querySelector(".btnCreateUser");btnInsertUser&&btnInsertUser.addEventListener("click",e=>{e.preventDefault(),userCreate(btnInsertUser.closest("form"))});