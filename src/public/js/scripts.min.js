const URL="http://192.168.0.10:3333/api",util=(()=>{const e=[];let t=0;image=((n,r,o,a)=>{n.addEventListener("change",i=>{i.preventDefault(),n.closest("form").classList.add("changed");const l={large:["my-2","col-12"],medium:["my-2","col-6"],small:["my-2","col-3"]};if(!a&&!l[a])return console.log("Informe o tamanho entre (large, medium e small)");const c=r,s=[...n.files],u=n.files[0];if(n.closest(".custom-file").querySelector("label").innerHTML=s.length+" imagens","mult"===o)s.map(n=>{const o=document.createElement("div");o.classList.add("mb-2","col-sm-3"),o.innerHTML='\n                    <img class="img-thumbnail" src="">\n                    ';const a=o.querySelector("img");if(FileReader&&n){var i=new FileReader;return i.onload=function(){a.src=i.result},i.readAsDataURL(n),e.push(n),a.dataset.index=e.indexOf(n),1===e.length&&a.classList.add("active"),((e,n)=>{e.addEventListener("click",r=>{const o=e.dataset.index;return allImages=n.querySelectorAll("img"),Array.from(allImages).forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),t=parseInt(o),console.log(t)})})(a,r),c.append(o)}});else{const t=document.createElement("div");t.classList.add(...l[a]),t.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const n=t.querySelector("img");if(FileReader&&u){var d=new FileReader;return d.onload=function(){n.src=d.result},d.readAsDataURL(u),e[0]=u,c.innerHTML="",c.append(t)}}})});const n=(e,t,r)=>{void 0===window.delayed_methods&&(window.delayed_methods={}),n[e]=Date.now();var o=n[e];setTimeout(function(){n[e]==o&&(n[e]="")},r||500)};return{image:image,images:e,request:e=>new Promise((t,n)=>{const r=document.body.dataset.token,{url:o,method:a,body:i,headers:l}=e,c={method:a||"GET",headers:{authorization:`Bearer ${r}`}};l&&(c.headers["content-type"]=l["content-type"]),l&&(c.headers.Accept=l.Accept),i&&(c.body=i),fetch(o,c).then(e=>e.json()).then(e=>e.error?n(e.error):t(e)).catch(e=>n(e))}),scroll:e=>{e.addEventListener("click",function(e){e.preventDefault(),document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth",block:"start"})})},validateSlug:e=>e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/ /g,"_"),newRequest:e=>new Promise((t,n)=>{const r=document.body.dataset.token,{url:o,method:a,body:i,headers:l}=e,c={method:a||"GET",headers:{authorization:`Bearer ${r}`}};l&&(c.headers["content-type"]=l["content-type"]),i&&(c.body=i),fetch(o,c).then(e=>e.json()).then(e=>e.error?n(e.error):t(e)).catch(e=>n(e))}),serialize:e=>{const t=[...e.elements],n={};return t.map((e,t)=>{if("radio"==e.type)return e.checked?n[e.name]=e.value:void 0;e.name&&(n[e.name]=e.value)}),n},resetForm:e=>{[...e.elements].map(e=>e.value="")},notify:e=>{const{icon:t,title:n,message:r,type:o}=e;return $.notify({icon:t,title:n,message:r},{type:o,template:'\n                <div data-notify="container" class="alert alert-dismissible alert-{0} alert-notify" role="alert">\n                    <span class="alert-icon" data-notify="icon"></span>\n                    <div class="alert-text"> \n                        <span class="alert-title" data-notify="title">{1}</span>\n                        <span data-notify="message">{2}</span>\n                    </div>\n                    <button type="button" class="close" data-notify="dismiss" aria-label="Close">\n                        <span aria-hidden="true">&times;</span>\n                    </button>\n                </div>\n                '})},get:e=>new Promise((t,n)=>{const r=document.body.dataset.token;fetch(e,{method:"GET",headers:{authorization:`Bearer ${r}`,"content-type":"application.json"}}).then(e=>e.json()).then(e=>e.error?n(e.error):t(e)).catch(e=>n(e))}),delayed_methods:n,dateEnd:(e,t,n)=>{e.addEventListener("blur",r=>{const o=t.value,a=new Date(o);a.setMonth(a.getMonth()+parseInt(e.value));const i=a.toISOString().substr(0,10);console.log(i),n.value=i})},maskMoney:e=>{e.addEventListener("keyup",function(t){t.preventDefault(),$(e).maskMoney({prefix:"R$ "})})}}})(),inputStart=document.querySelector("input#locationStart"),inputEnd=document.querySelector("input#locationEnd"),inputMonth=document.querySelector("input#locationTime");inputStart&&inputEnd&&inputMonth&&util.dateEnd(inputMonth,inputStart,inputEnd);const allprods=document.querySelector(".nav-link.dropdown-toggle"),hoverMenu=document.querySelector(".nav-item.dropdown");if(hoverMenu&&(hoverMenu.onmouseover=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.add("show")}),hoverMenu.onmouseout=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.remove("show")})),allprods&&allprods.addEventListener("click",function(e){e.preventDefault(),url=allprods.getAttribute("href"),window.matchMedia("(min-width:800px)").matches&&(window.location.href=url)}),document.querySelector("input.cpf"))var cpf=new Cleave("input.cpf",{delimiters:[".",".","-"],blocks:[3,3,3,2],uppercase:!0});if(document.querySelector("input.rg"))var rg=new Cleave("input.rg",{delimiters:[".",".","-"],blocks:[2,3,3,1],uppercase:!0});if(document.querySelector("input.zipCode"))var cep=new Cleave("input.zipCode",{delimiters:["-"],blocks:[5,3],uppercase:!0});if(document.querySelector("input#phone"))var phones=new Cleave("input#phone",{phone:!0,phoneRegionCode:"BR"});if(document.querySelector("input#cell"))var cell=new Cleave("input#cell",{phone:!0,phoneRegionCode:"BR"});const cleaveMoney={numeral:!0,prefix:"R$ ",rawValueTrimPrefix:!0},inputsMoney=[...document.querySelectorAll("input.moneyValue")];if(inputsMoney&&inputsMoney.forEach(e=>util.maskMoney(e)),document.querySelector(".iptu"))var iptu=new Cleave("input#iptu",cleaveMoney);if(document.querySelector(".condominium"))var condominium=new Cleave("input#condominium",cleaveMoney);if(document.querySelector(".water"))var water=new Cleave("input#water",cleaveMoney);if(document.querySelector(".energy"))var energy=new Cleave("input#energy",cleaveMoney);if(document.querySelector(".trash"))var trash=new Cleave("input#trash",cleaveMoney);if(document.querySelector(".cleaningFee"))var cleaningFee=new Cleave("input#cleaningFee",cleaveMoney);if(document.querySelector(".othersValues"))var othersValues=new Cleave("input#othersValues",cleaveMoney);const btnValidat=document.querySelector(".btnAnchor");btnValidat&&util.scroll(btnValidat),function(){"use strict";window.addEventListener("load",function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(e){e.addEventListener("submit",t=>{!1===e.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")},!1)})},!1)}();const client=(()=>{const e=$(".dataTable").DataTable(),t=(e,t)=>{const n=document.createElement("tr"),r=t.closest(".inputWrapper").querySelector("input.searching"),{name:o,cpf:a,gender:i,type:l}=e;return n.innerHTML=`\n            <th>${o}</th>\n            <th>${a}</th>\n            <th>${i}</th>\n            <th>${l}</th>\n        `,n.addEventListener("click",e=>{e.preventDefault(),$(r).tagsinput("removeAll"),$(r).tagsinput("add",o),t.closest(".responseCard").classList.remove("show")}),n};return{create:e=>{e.addEventListener("submit",t=>{if(t.preventDefault(),e.checkValidity()){const t=util.serialize(e),n=(e.querySelector(".alert"),document.querySelector("#modal-notification"));return util.request({url:"/api/client",method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(t=>{util.resetForm(e),n&&(n.querySelector(".modal-body h2").innerHTML=`Cliente ${t.name} cadastrado com sucesso!`,$(n).modal("show"))}).catch(e=>{const{error:t}=e;util.notify({icon:"alert-icon ni ni-bell-55",title:"Atenção! alguns erros foram encontrados!",message:e,type:"warning"}),console.log(e)})}})},show:e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.id,r=document.querySelector(".formEditClient"),o=r.querySelector("button"),a=$("#modalEditClient");return r.dataset.id=n,util.request({url:`/api/client/${n}`,method:"GET",headers:{"content-type":"application/json"}}).then(e=>(a.modal("show"),a.on("hidden.bs.modal",function(e){[...r.elements].map(e=>e.disabled=!0),o.type="button",o.disabled=!1,o.querySelector(".btn-inner--text").innerHTML="Editar",$(this).off("hidden.bs.modal")}),((e,t)=>{const{name:n,cpf:r,rg:o,gender:a,nationality:i,marital:l,birthDate:c,type:s,note:u,address:d,contact:p}=e;var m=new Date(c).toISOString().slice(0,10);t.elements.name.value=n,t.elements.cpf.value=r,t.elements.rg.value=o,t.elements.gender.value=a,t.elements.nationality.value=i,t.elements.marital.value=l,t.elements.birth_date.value=m,t.elements.type.value=s,t.elements.note.value=u;const{address:y,city:h,state:f,street:v,zipCode:g}=d;t.elements.address.value=y,t.elements.city.value=h,t.elements.state.value=f,t.elements.street.value=v,t.elements.zipCode.value=g;const{cell:S,email:L,other:q,phone:w}=p;t.elements.cell.value=S,t.elements.email.value=L,t.elements.other.value=q,t.elements.phone.value=w})(e,r))).catch(e=>{console.log(e)})})},destroy:t=>{t.addEventListener("click",function(n){n.preventDefault();const r=t.dataset.id;return util.request({url:`/api/client/${r}`,method:"DELETE",headers:{"content-type":"application/json"}}).then(n=>(e.row($(t.closest("tr"))).remove().draw(),Swal.fire("Excluído","Cliente excluído com sucesso!","success"))).catch(e=>(console.log(e),Swal.fire("Erro",e,"error")))})},edit:e=>{const t=e.querySelector("button"),n=$("#modalEditClient");t.addEventListener("click",function(r){if(r.preventDefault(),"button"!=t.type){const r=e.dataset.id,o=util.serialize(e);return util.request({url:`/api/client/${r}`,method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify(o)}).then(r=>{n.modal("hide"),n.on("hidden.bs.modal",function(n){return[...e.elements].map(e=>e.disabled=!0),t.type="button",t.disabled=!1,t.querySelector(".btn-inner--text").innerHTML="Editar",$(this).off("hidden.bs.modal"),Swal.fire("Editado",`Cliente ${r.name} editado com sucesso!`,"success")})}).catch(e=>Swal.fire("Erro",e,"error"))}[...e.elements].map(e=>e.disabled=!1),t.type="submit",t.querySelector(".btn-inner--text").innerHTML="Atualizar"}),e.addEventListener("submit",function(e){e.preventDefault()})},search:(e,n)=>{e.addEventListener("keyup",r=>{const o=e.closest(".inputWrapper").querySelector(".resultList");if(!e.value.length)return o.closest(".responseCard").classList.remove("show");e.value&&e.value.length>3&&util.delayed_methods("check date parallel",(async(e,n,r)=>{try{const o=await util.get(`/api/client_search/${e}?type=${n}`);return r.innerHTML="",r.closest(".responseCard").classList.add("show"),o.map(e=>r.append(t(e,r)))}catch(e){console.log(e)}})(e.value,n,o))})}}})(),inputGuarantor=document.querySelector('.guarantorTag input[type="text"]');inputGuarantor&&client.search(inputGuarantor,"fiador");const inputOwner=document.querySelector('.ownerTag input[type="text"]');inputOwner&&client.search(inputOwner,"proprietário");const inputOccupant=document.querySelector('.occupantTag input[type="text"]');inputOccupant&&client.search(inputOccupant,"inquilino");const formEditClient=document.querySelector(".formEditClient");formEditClient&&client.edit(formEditClient);const clientDestroy=document.querySelectorAll(".clientList tr .clientDestroy");clientDestroy&&Array.from(clientDestroy).forEach(e=>client.destroy(e));const clientList=document.querySelectorAll(".clientList tr .clientView");clientList&&Array.from(clientList).forEach(e=>client.show(e)),console.log("estou funcionando");const formClient=document.querySelector(".formClient");formClient&&client.create(formClient);const btnNextTab=document.querySelectorAll(".nextTab");$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){e.target,e.relatedTarget;const t=document.querySelector(".locationProgress");t.getAttribute("aria-valuenow");"valuesDiscount"==e.target.getAttribute("aria-controls")?(t.style.width="60%",t.setAttribute("aria-valuenow","60")):"tabs-icons-text-3"==e.target.getAttribute("aria-controls")?(t.style.width="100%",t.setAttribute("aria-valuenow","100")):(t.style.width="30%",t.setAttribute("aria-valuenow","30"))}),Array.from(btnNextTab).forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("href"),r=document.querySelector(`${n}-tab`);r&&r.click()})});const locations={hasChild:e=>{e.addEventListener("change",function(t){const n=e.closest(".custom-control").querySelector(".Child"),r=[...document.querySelectorAll(".Child")];(e.checked=!0)?(r.map(e=>e.classList.remove("show")),n&&n.classList.add("show")):r.map(e=>e.classList.remove("show"))})},create:e=>{e.addEventListener("submit",t=>{t.preventDefault();const n=util.serialize(e);return util.request({url:"/api/location",method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n)}).then(e=>{const{id:t}=e;return Swal.fire("Criado!",`Locação ${t} criada com sucesso!`,"success")}).catch(e=>util.notify({icon:"alert-icon ni ni-bell-55",title:"Atenção! alguns erros foram encontrados!",message:e,type:"warning"}))})}},formLocation=document.querySelector(".formLocations");formLocation&&locations.create(formLocation);const inputHasChild=[...document.querySelectorAll("input.hasChild")];inputHasChild&&inputHasChild.forEach(e=>locations.hasChild(e));const login={login:e=>{e.addEventListener("submit",t=>{t.preventDefault();const n=util.serialize(e);return util.request({url:"/api/login",method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n)}).then(e=>window.location.href="/dashboard").catch(e=>console.log(e))})}},formLogin=document.querySelector(".formLogin");formLogin&&login.login(formLogin);const property=(()=>{const e=e=>{const t=document.createElement("tr"),{name:n,description:r,type:o,propertyIs:a}=e;return t.innerHTML=`\n            <th>${n}</th>\n            <th>${r}</th>\n            <th>${o}</th>\n            <th>${a}</th>\n        `,t.addEventListener("click",e=>{e.preventDefault(),$("input#property").tagsinput("removeAll"),$("input#property").tagsinput("add",n),document.querySelector(".propertyList").closest(".responseProperty").classList.remove("show")}),t};return{create:e=>{e.addEventListener("submit",function(t){t.preventDefault();const n=util.serialize(e);if(console.log(n),e.checkValidity())return util.request({url:"/api/property",method:"POST",headers:{Accept:"application/json","content-type":"application/json"},body:JSON.stringify(n)}).then(e=>{const{name:t}=e.property;return Swal.fire("Editado",`Imóvel ${t} cadastrado com sucesso!`,"success")}).catch(e=>{util.notify({icon:"alert-icon ni ni-bell-55",title:"Atenção! alguns erros foram encontrados!",message:e,type:"warning"})});console.log(n)})},show:e=>{e.addEventListener("click",function(t){t.preventDefault();const n=e.dataset.id,r=$("#propertyModal"),o=document.querySelector(".propertyName"),a=document.querySelector(".properType"),i=document.querySelector(".propertyTradingType"),l=document.querySelector(".propertyStreet"),c=document.querySelector(".propertyAddress"),s=document.querySelector(".propertyWalk"),u=document.querySelector(".propertyCity"),d=document.querySelector(".propertyState"),p=document.querySelector(".propertyReference"),m=document.querySelector(".propertyBedrooms"),y=document.querySelector(".propertyBathrooms"),h=document.querySelector(".propertyToilet"),f=document.querySelector(".propertySuites"),v=document.querySelector(".propertyDemiSuites"),g=document.querySelector(".propertyJobs"),S=document.querySelector(".propertyFlooring"),L=document.querySelector(".propertyFurnished"),q=document.querySelector(".propertyOthersValue"),w=document.querySelector(".propertyCleaningFee"),b=document.querySelector(".propertyTrash"),T=document.querySelector(".propertyEnergy"),M=document.querySelector(".propertyWater"),E=document.querySelector(".propertyCondominium"),C=document.querySelector(".propertyIptu"),H=document.querySelector(".propertyOtherInformation"),A=document.querySelector(".propertyLiquidatorPhone"),k=document.querySelector(".propertyLiquidator"),D=document.querySelector(".propertyKeyNumber"),P=document.querySelector(".propertyVisitingHours"),x=document.querySelector(".propertyKeysAreWith");return util.get(`/api/property/${n}`).then(e=>{const{name:t,propertyIs:n,tradingType:$,type:O,address:I,feature:R,value:z,information:F}=e;o.innerHTML=t,a.innerHTML=O,i.innerHTML=$;const{address:N,city:V,complement:j,state:_,street:B,walk:G,reference_point:J}=I;l.innerHTML=B,c.innerHTML=N,s.innerHTML=G,u.innerHTML=V,d.innerHTML=_,p.innerHTML=J;const{bathrooms:W,bedrooms:U,demiSuites:K,flooring:Q,furnished:X,jobs:Y,suites:Z,toilet:ee}=R;m.innerHTML=U,y.innerHTML=W,h.innerHTML=ee,f.innerHTML=Z,v.innerHTML=K,g.innerHTML=Y,S.innerHTML=Q,L.innerHTML=X?"SIM":"NÃO";const{cleaningFee:te,condominium:ne,energy:re,iptu:oe,others:ae,trash:ie,water:le}=z;var ce=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});q.innerHTML=ce.format(ae),w.innerHTML=ce.format(te),b.innerHTML=ce.format(ie),T.innerHTML=ce.format(re),M.innerHTML=ce.format(le),E.innerHTML=ce.format(ne),C.innerHTML=ce.format(oe);const{keyNumber:se,keysAreWith:ue,liquidator:de,liquidatorPhone:pe,other:me,visitingHours:ye}=F;H.innerHTML=me,A.innerHTML=pe,k.innerHTML=de,D.innerHTML=se,P.innerHTML=ye,x.innerHTML=ue,r.modal("show")}).catch(e=>console.log(e))})},search:t=>{t.addEventListener("keyup",n=>{const r=document.querySelector(".propertyList");if(!t.value.length)return r.closest(".responseProperty").classList.remove("show");t.value&&t.value.length>3&&util.delayed_methods("check date parallel",(async t=>{try{const n=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=await util.get(`/api/property_search/${n}`),o=document.querySelector(".propertyList");return o.innerHTML="",o.closest(".responseProperty").classList.add("show"),r.map(t=>o.append(e(t)))}catch(e){console.log(e)}})(t.value))})}}})(),_property=document.querySelector('.propertyTag input[type="text"]');_property&&property.search(_property);const btnShowProperty=document.querySelectorAll(".property-show");btnShowProperty&&Array.from(btnShowProperty).forEach(e=>property.show(e));const formInsertProperty=document.querySelector(".formInsertProperty");formInsertProperty&&property.create(formInsertProperty);