const URL="http://192.168.0.10:3333/api",util=(()=>{const e=[];let t=0;image=((r,o,n,a)=>{r.addEventListener("change",s=>{s.preventDefault(),r.closest("form").classList.add("changed");const c={large:["my-2","col-12"],medium:["my-2","col-6"],small:["my-2","col-3"]};if(!a&&!c[a])return console.log("Informe o tamanho entre (large, medium e small)");const i=o,l=[...r.files],d=r.files[0];if(r.closest(".custom-file").querySelector("label").innerHTML=l.length+" imagens","mult"===n)l.map(r=>{const n=document.createElement("div");n.classList.add("mb-2","col-sm-3"),n.innerHTML='\n                    <img class="img-thumbnail" src="">\n                    ';const a=n.querySelector("img");if(FileReader&&r){var s=new FileReader;return s.onload=function(){a.src=s.result},s.readAsDataURL(r),e.push(r),a.dataset.index=e.indexOf(r),1===e.length&&a.classList.add("active"),((e,r)=>{e.addEventListener("click",o=>{const n=e.dataset.index;return allImages=r.querySelectorAll("img"),Array.from(allImages).forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),t=parseInt(n),console.log(t)})})(a,o),i.append(n)}});else{const t=document.createElement("div");t.classList.add(...c[a]),t.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const r=t.querySelector("img");if(FileReader&&d){var u=new FileReader;return u.onload=function(){r.src=u.result},u.readAsDataURL(d),e[0]=d,i.innerHTML="",i.append(t)}}})});return{image:image,images:e,request:(e,t,r,o,n)=>new Promise((a,s)=>{const c=`Bearer ${document.body.dataset.token}`,i={};n&&(i["content-type"]=n);const l=o||null;r&&(i.authorization=c),fetch(`/api/${e}`,{method:t,headers:i,body:l}).then(e=>e.json()).then(e=>e.error?s(e.error):a(e)).catch(e=>s(e))}),scroll:e=>{$(e).on("click",function(e){if(""!==this.hash){e.preventDefault();var t=this.hash;$("html, body").animate({scrollTop:$(t).offset().top},800,function(){window.location.hash=t})}})}}})(),allprods=document.querySelector(".nav-link.dropdown-toggle"),hoverMenu=document.querySelector(".nav-item.dropdown");hoverMenu&&(hoverMenu.onmouseover=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.add("show")}),hoverMenu.onmouseout=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.remove("show")})),allprods.addEventListener("click",function(e){e.preventDefault(),url=allprods.getAttribute("href"),window.matchMedia("(min-width:800px)").matches&&(window.location.href=url)});const btnValidat=document.querySelector(".btn-validateProd");btnValidat&&util.scroll(btnValidat),function(){"use strict";window.addEventListener("load",function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(e){e.addEventListener("submit",t=>{!1===e.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")},!1)})},!1)}();const category=(()=>{const e=$("#dataTable").DataTable(),t=(t,o)=>{r(o).then(r=>(e.row($(t.closest("tr"))).remove().draw(),Swal.fire({title:`Categoria ${r.name} removida com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:e,text:"Ocorreu um erro ao remover a categoria",icon:"error",confirmButtonText:"Ok"}))},r=e=>new Promise((t,r)=>{const o=document.body.dataset.token;fetch(`/api/category/${e}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${o}`}}).then(e=>e.ok?e.json():r("Erro ao deletar categoria")).then(e=>t(e)).catch(e=>r(e))}),o=e=>(e=>{const r=e.dataset.id;e.addEventListener("click",o=>(o.preventDefault(),t(e,r)))})(e),n=t=>{t.addEventListener("click",r=>{const o=t.dataset.id,n=document.querySelector(".btnEditCategory");return(e=>new Promise((t,r)=>{const o=document.body.dataset.token;fetch(`/api/category/${e}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${o}`}}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(o).then(t=>{const r=document.querySelector(".editCategoryName"),o=document.querySelector(".editCategoryDescription"),a=document.querySelector(".editCategorySlug"),s=document.querySelector(".editCategoryParent"),{id:c,name:i,description:l,slug:d,parent:u}=t;return s.querySelector(`option[value="${u}"]`)&&(s.querySelector(`option[value="${u}"]`).selected=!0),r.value=i,o.value=l,a.value=d,n.addEventListener("click",t=>(e=>new Promise((t,r)=>{const o=document.body.dataset.token,{id:n,name:a,description:s,slug:c,parent:i}=e;fetch(`/api/category/${n}`,{method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({name:a,description:s,slug:c,parent:i})}).then(e=>e.ok?e.json():r("Erro ao criar categoria")).then(e=>t(e)).catch(e=>r(e))}))({id:c,name:r.value,description:o.value,slug:a.value,parent:s.value||null}).then(t=>(t=>{const{id:r,name:o,description:n,slug:a,parent:s,createdAt:c}=t,i=document.querySelector(`.category-${r}`);if(i){i.querySelector("td:nth-child(2)"),i.querySelector("td:nth-child(3)"),i.querySelector("td:nth-child(5)");let t=new Date(c);t=new Intl.DateTimeFormat("pt-BR").format(t);let r=e.row($(i)).data();return console.log(i),r[1]=o,r[2]=n,e.row($(i)).data(r).draw(),Swal.fire({title:`Categoria ${o} editada com sucesso!`,icon:"success",confirmButtonText:"Ok"})}})(t)))}).catch(e=>Swal.fire({title:"Erro ao editar categoria",icon:"error",confirmButtonText:"Ok"}))})};return{destroy:o,create:t=>{t.addEventListener("click",t=>{t.preventDefault();const r=document.querySelector(".categoryName"),a=document.querySelector(".categoryDescription"),s=document.querySelector(".categorySlug"),c=document.querySelector(".categoryParent");return(e=>new Promise((t,r)=>{e.map(e=>{const{input:o,msg:n}=e;return console.log(),o.value&&"Selecione..."!=o.value?t():(o.setCustomValidity(n),o.reportValidity(),r(n))})}))([{input:r,msg:"Informe um nome para a categoria"}]).then(()=>(e=>new Promise((t,r)=>{const o=document.body.dataset.token,{name:n,description:a,slug:s,parent:c}=e;fetch("/api/category",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({name:n,description:a,slug:s,parent:c})}).then(e=>e.json()).then(e=>{if(e.error)return r(e.error);t(e)}).catch(e=>r(e))}))({name:r.value,description:a.value,slug:s.value,parent:c.value||null}).then(t=>((t=>{const{id:r,name:a,description:s,createdAt:c}=t;let i=new Date(c);i=new Intl.DateTimeFormat("pt-BR").format(i);const l=e.row.add([r,a,s,0,`\x3c!-- Botão de ação Editar // --\x3e\n            <button type="button" class="btn btn-datatable btn-icon btn-transparent-dark editCategory py-0" data-toggle="modal" data-target="#modalEditCategory" data-id="${r}">\n                <i class="fas fa-edit"></i>\n            </button>\n            \x3c!-- Botão de ação Editar // --\x3e\n            <button type="button" class="btn btn-datatable btn-icon btn-transparent-dark categoryDestroy py-0" data-id="${r}">\n                <i class="far fa-trash-alt"></i>\n            </button>`]).draw().node();l.classList.add(`category-${r}`);const d=l.querySelector(".editCategory");n(d);const u=l.querySelector(".categoryDestroy");o(u)})(t),Swal.fire({title:`Categoria ${t.name} criada com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))})},edit:n}})(),btnCategoryDestroy=document.querySelectorAll(".categoryDestroy");btnCategoryDestroy&&Array.from(btnCategoryDestroy).forEach(e=>category.destroy(e));const btnModalEditCategory=document.querySelectorAll(".editCategory");btnModalEditCategory&&Array.from(btnModalEditCategory).forEach(e=>category.edit(e));const btnCreateCategory=document.querySelector(".btnCreateCategory");btnCreateCategory&&category.create(btnCreateCategory);const loginResource="login",requestLogin=e=>new Promise((t,r)=>{const{email:o,password:n,gToken:a}=e;fetch("/api/login",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:o,password:n,gToken:a})}).then(e=>e.json()).then(e=>e.error?r(e.error):(t(e),console.log(e))).catch(e=>r(e))}),login=e=>{const t=e.querySelector(".loginMail"),r=e.querySelector(".loginPassword");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),r.value?void grecaptcha.ready(function(){grecaptcha.execute("6LeM9q0ZAAAAAPJ827IgGMXdYRB9NdnNkbfrmaEY",{action:"login"}).then(function(o){return requestLogin({email:t.value,password:r.value,gToken:o}).then(e=>{window.location.href="/dashboard"}).catch(t=>{const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t,e.prepend(r),setTimeout(()=>{r.remove()},4e3)})})}):r.classList.add("is-invalid")):t.classList.add("is-invalid")},btnLogin=document.querySelector(".btnLogin");btnLogin&&btnLogin.addEventListener("click",e=>{e.preventDefault(),login(btnLogin.closest("form"))});const page=(()=>{const e=e=>e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/ /g,"_"),t=e=>{const t={},r={},o="Preencha este campo";return new Promise((n,a)=>(e.map(e=>{const n=e;if(!(n.classList.contains("pageSlug")||"BUTTON"==n.tagName||n.value&&"Selecione..."!=n.value))return n.setCustomValidity(o),n.reportValidity(),a(o);n.classList.contains("pageTitle")&&(t.title=n.value),n.classList.contains("pageContent")&&(t.content=n.value),n.classList.contains("pageSlug")&&(t.slug=n.value),n.classList.contains("bannerTitle")&&(r.title=n.value),n.classList.contains("bannerPosition")&&(r.position=n.value),n.classList.contains("bannerDescription")&&(r.description=n.value)}),(e=>{for(var t in e)if(e.hasOwnProperty(t))return!1;return!0})(r)||(t.banner=r),n(t)))},r=(e,r)=>{const o=[...e.elements];return t(o).then(e=>(e=>new Promise((t,r)=>{const{title:o,slug:n,content:a}=e,s=`Bearer ${document.body.dataset.token}`;fetch("/api/page",{method:"POST",headers:{"content-type":"application/json",authorization:s},body:JSON.stringify({title:o,slug:n,content:a})}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}))(e).then(e=>((e=>{const{title:t,slug:r}=e,o=document.querySelector("#collapsePages > div"),n=document.querySelector("#collapsePages > div .collapse-divider"),a=document.createElement("a");a.classList.add("collapse-item"),a.setAttribute("href",`/page/${r}`),a.innerHTML=t,o.insertBefore(a,n)})(e),Swal.fire({title:"Página criada",text:`A página ${e.title} foi criada com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Erro ao criar página",text:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))};return{create:t=>{const o=t.closest("form");(t=>{const r=t.querySelector(".pageTitle"),o=t.querySelector(".pageSlug");let n=!0;n&&r.addEventListener("keyup",t=>{o.value=e(r.value)}),o.addEventListener("keyup",t=>{o.value=e(o.value),n=!1})})(o),t.addEventListener("click",e=>(e.preventDefault(),r(o)))},update:(e,r,o)=>{e.addEventListener("submit",async n=>{n.preventDefault(),console.log("Banners",r);const a=[...e.elements],s={},c=new FormData;if(c.append("file",r[0]),r){if(!o)return console.log("Nenhum formulário de banner inserido");const e=[...o.elements];if(o.classList.contains("changed")){const r=await t(e),o=await util.request("banner-image","POST",!0,c);if(!r)return console.log("Erro na validação do banner");s.banner={image_id:o.id,title:r.banner.title,position:r.banner.position,description:r.banner.description}}}const i=e.querySelector("button").dataset.id;return t(a).then(e=>{const{slug:t,content:r}=e;return s.id=i,s.slug=t,s.content=r,(e=>new Promise((t,r)=>{const{slug:o,content:n,banner:a}=e,s=`Bearer ${document.body.dataset.token}`;fetch(`/api/page/${e.id}`,{method:"PUT",headers:{"content-type":"application/json",authorization:s},body:JSON.stringify({slug:o,content:n,banner:a})}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}))(s).then(e=>(o&&o.classList.remove("changed"),Swal.fire({title:"Página Atualizada",text:`A página ${e.title} foi atualizada com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Erro ao atualizar página página",text:e,icon:"error",confirmButtonText:"Ok"}))}).catch(e=>console.log(e))})}}})(),banner={create:e=>{e.addEventListener("submit",function(t){t.preventDefault();const r=e.querySelector("button").dataset.id;return(e=>{const t={};return new Promise((r,o)=>(e.map(e=>{const{input:r,msg:n}=e;if(!(r.classList.contains("pageSlug")||r.value&&"Selecione..."!=r.value))return r.setCustomValidity(n),r.reportValidity(),o(n);r.classList.contains("pageTitle")&&(t.title=r.value),r.classList.contains("pageContent")&&(t.content=r.value),r.classList.contains("pageSlug")&&(t.slug=r.value)}),console.log(t),r(t)))})(Array.from(e.elements).map(e=>{if("BUTTON"!=e.tagName)return{input:e,msg:"Preencha este campo"}})).then(e=>(e=>new Promise((t,r)=>{const{title:o,position:n,description:a,page_id:s}=e,c=`Bearer ${document.body.dataset.token}`;fetch(`/api/banner/${s}`,{method:"POST",headers:{"content-type":"application/json",authorization:c},body:JSON.stringify({title:o,position:n,description:a})}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}))({page_id:r,title:e.title,position:e.position,description:e.description}).then(e=>Swal.fire({title:"Banner criado",text:`O banner ${e.title} foi criado com sucesso!`,icon:"success",confirmButtonText:"Ok"})).catch(e=>Swal.fire({title:"Erro ao criar Banner",text:e,icon:"error",confirmButtonText:"Ok"})))})}},btnAddPage=document.querySelector(".btnCreateNewPage");btnAddPage&&page.create(btnAddPage);const updatePageForm=document.querySelector(".updatePageForm"),formBanner=document.querySelector(".formBanner");updatePageForm&&formBanner&&page.update(updatePageForm,util.images,formBanner);const bannerImage=document.querySelector(".bannerImage"),bannersContainer=document.querySelector(".bannersContainer");bannerImage&&bannersContainer&&util.image(bannerImage,bannersContainer,"single","large");const newsletter={subscribe:e=>{e.addEventListener("submit",function(t){return t.preventDefault(),(e=>{const t={};return new Promise((r,o)=>(e.map(e=>{const{input:r,msg:n}=e;if(console.log(r.value),"BUTTON"!=r.tagName&&(!r.value||"Selecione..."==r.value))return r.setCustomValidity(n),r.reportValidity(),o(n);r.classList.contains("subName")&&(t.name=r.value),r.classList.contains("subEmail")&&(t.email=r.value)}),r(t)))})(Array.from(e.elements).map(e=>({input:e,msg:"Por favor preencha este campo"}))).then(e=>(e=>{const{name:t,email:r}=e;return new Promise((e,o)=>{fetch("/api/subscriber",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,email:r})}).then(e=>e.json()).then(t=>t.error?o(t.error):e(t)).catch(e=>o(e))})})(e).then(t=>Swal.fire({title:"Cadastrado com sucesso!",text:`Olá ${e.name} você se cadastrou com sucesso em nossa newsletter`,icon:"success",confirmButtonText:"Ok"})).catch(e=>Swal.fire({title:"Erro ao cadastrar-se",text:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))})}},newsForm=document.querySelector(".newsForm");newsForm&&newsletter.subscribe(newsForm);const partner=(()=>{const e=$("#dataTable").DataTable(),t=e=>new Promise((t,r)=>{const o=document.body.dataset.token,{url:n,method:a,body:s,headers:c}=e,i={method:a||"GET",headers:{authorization:`Bearer ${o}`,"content-type":c["content-type"]||null}};s&&(i.body=JSON.stringify(s)),console.log("Options request: ",i),fetch(n,i).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}),r=r=>{r.addEventListener("click",o=>{o.preventDefault();const n=r.dataset.id;return t({url:`/api/partner/${n}`,method:"DELETE",headers:{"content-type":"application/json"}}).then(t=>(e.row($(r.closest("tr"))).remove().draw(),Swal.fire({title:"Sucesso!",text:`Parceiro ${t.title} deletado com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Erro!",text:e,icon:"error",confirmButtonText:"Ok"}))})};return{create:o=>{const n=o.querySelector('input[type="file"]');n&&(e=>{e.addEventListener("change",t=>{const r=e.value.split(/(\\|\/)/g).pop();e.closest(".custom-file").querySelector("label").innerHTML=r;const o=document.querySelector(".imagePartner"),n=[...e.files];console.log("Lista de imagens",n),n.map(t=>{if("image/png"!=t.type)return e.value="",Swal.fire({title:"Imagem invlálida",text:"A imagem deve ser no formato png",icon:"error",confirmButtonText:"Ok"});const r=document.createElement("div");r.classList.add("mb-2","col-12"),r.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const n=r.querySelector("img");if(FileReader&&t){var a=new FileReader;return a.onload=function(){n.src=a.result},a.readAsDataURL(t),o.innerHTML="",o.append(r)}})})})(n),o.addEventListener("submit",n=>{if(n.preventDefault(),o.checkValidity()){putSpinnet(o,"insert");const n={title:o.querySelector(".partnerTitle").value,company:o.querySelector(".partnerCompany").value,content:o.querySelector(".partnerContent").value},a={url:"/api/partner",method:"POST",headers:{"content-type":"application/json"},body:{title:n.title,company:n.company,content:n.content}};return t(a).then(t=>{const{title:n,company:a,id:s,createdAt:c}=t,i=[...o.elements];o.classList.remove("was-validated"),document.querySelector(".imagePartner").innerHTML="",i.map(e=>{e.value=""});const l=new Intl.DateTimeFormat("pt-BR").format(new Date(c)),d=e.row.add([s,n,a,l,`<button type="button"\n                                    class="btn btn-datatable btn-icon btn-transparent-dark partnerDestroy py-0"\n                                    data-id="${s}">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"\n                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"\n                                        stroke-linejoin="round" class="feather feather-trash-2">\n                                        <polyline points="3 6 5 6 21 6"></polyline>\n                                        <path\n                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">\n                                        </path>\n                                        <line x1="10" y1="11" x2="10" y2="17"></line>\n                                        <line x1="14" y1="11" x2="14" y2="17"></line>\n                                    </svg>\n                                </button>`]).draw().node(),u=d.querySelector("button");return r(u),console.log("Criated Partner: ",d),putSpinnet(o,"remove"),Swal.fire({title:"Sucesso!",text:`Parceiro ${n} criado com sucesso!`,icon:"success",confirmButtonText:"Ok"})}).catch(e=>(putSpinnet(o,"remove"),Swal.fire({title:"Erro",text:e,icon:"error",confirmButtonText:"Ok"})))}})},destroy:r}})(),formPartner=document.querySelector(".partnerForm"),partnerDestroy=document.querySelectorAll(".partnerDestroy");formPartner&&partner.create(formPartner),partnerDestroy&&Array.from(partnerDestroy).forEach(e=>{partner.destroy(e)});const btnsProduct=document.querySelectorAll(".productDelete"),requestDeleteProduct=e=>new Promise((t,r)=>{const o=document.body.dataset.token;fetch(`/api/product/${e}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${o}`}}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))});btnsProduct&&Array.from(btnsProduct).forEach(e=>{e.addEventListener("click",t=>{const r=e.dataset.product;requestDeleteProduct(r).then(t=>(e.closest(".col-12").remove(),Swal.fire({title:"Produto excluido com sucesso!",text:`O produto ${t.name} foi excluído`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Arro ao remover produto",text:e,icon:"error",confirmButtonText:"Ok"}))})});const productResource="product";let codesInsert=[],productImages=[];const imgProduct=(()=>{const e=[],t=[];let r=0;const o=e=>{e.addEventListener("click",t=>{const o=e.dataset.index;return allImages=e.closest(".imagesProductContainer").querySelectorAll("img"),Array.from(allImages).forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),r=parseInt(o),console.log(r)})};return{create:()=>new Promise(async(o,n)=>{const a=document.body.dataset.token,s=e.map(async e=>{const r=new FormData;return r.append("file",e),e=await fetch("/api/image/product",{method:"POST",headers:{authorization:`Bearer ${a}`},body:r}).then(e=>e.json()).then(e=>e.error?n(e.error):(t.push(e.id),e)).catch(e=>n(e)),await e}),c=await Promise.all(s);return c[r].default=!0,console.log("Resultado retornado: ",c),o(c)}),change:t=>{t.addEventListener("change",r=>{r.preventDefault();const n=document.querySelector(".imagesProductContainer"),a=[...t.files];t.closest(".custom-file").querySelector("label").innerHTML=a.length+" imagens",console.log("Lista de imagens",a),a.map(t=>{const r=document.createElement("div");r.classList.add("mb-2","col-sm-3"),r.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const a=r.querySelector("img");if(FileReader&&t){var s=new FileReader;return s.onload=function(){a.src=s.result},s.readAsDataURL(t),e.push(t),a.dataset.index=e.indexOf(t),1===e.length&&a.classList.add("active"),o(a),n.append(r)}})})},images:t,default:o}})(),clearListItems=()=>{codesInsert=[];const e=document.querySelectorAll(".colapseCodes > div > .row > div");if(e)return Array.from(e).forEach(e=>{if(e)return e.remove()}),document.querySelector(".headerListItem span.badge,badge-primary").innerHTML=codesInsert.length},putSpinnet=(e,t)=>{const r=document.createElement("div");return r.classList.add("spinner-border","text-primary","float-right"),r.setAttribute("role","status"),r.innerHTML='<span class="sr-only">Loading...</span>',"insert"===t?e.append(r):"remove"===t&&e.querySelector(".spinner-border")?e.querySelector(".spinner-border").remove():void 0},changeBadgeForm=e=>{const t=document.querySelector(".colapseCodes"),r=t.closest(".accordion").querySelector(".card-header .badge");if(t)return r.innerHTML=e},removeCodeForm=e=>{e.addEventListener("click",t=>{const r=e.dataset.code,o=codesInsert.find(e=>e.code===r);if(o){let t=codesInsert.indexOf(o);return codesInsert.splice(t,1),e.closest(".col-12").remove(),changeBadgeForm(codesInsert.length)}console.log("código não esta presente")})},checkCodeInList=e=>!codesInsert.find(t=>t.code===e),createItem=e=>{const{prefix:t,code:r}=e,o=document.createElement("div");return o.classList.add("col-12","mb-3"),o.innerHTML=`\n    <div class="card">\n        <div class="card-header">\n            ${t}\n            <button type="button" class="float-right btn btn-danger btn-sm" data-code="${r}"><i class="fas fa-trash-alt"></i></button>\n        </div>\n        <div class="card-body">\n        ${r}\n        </div>\n    </div>\n    `,removeCodeForm(o.querySelector("button")),o},formValidate=e=>new Promise((t,r)=>{if("object"!=typeof e)return r("O parametro deve ser um array");const o=e.filter(e=>{if(!e.value)return e});return t({valids:e.filter(e=>{if(e.value)return e}),invalids:o})}),insertSingleCode=e=>{e.addEventListener("click",t=>{if(t.preventDefault(),e.disabled)return!1;const r=e.closest("form");putSpinnet(r,"insert");const o=r.querySelector(".productItemName"),n=r.querySelector(".productCode");return formValidate([o,n]).then(e=>{const{valids:t,invalids:a}=e;if(a.length)return a.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")});if(!checkCodeInList(n.value))return putSpinnet(r,"remove"),Swal.fire({title:"O Código duplicado",text:`O Código ${n.value} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:n.value,name:o.value});const s=createItem({prefix:o.value,code:n.value}),c=document.querySelector(".colapseCodes");return c?(c.querySelector(".card-body > .row").append(s),changeBadgeForm(codesInsert.length),putSpinnet(r,"remove"),c.classList.add("show")):void 0})})},changeFileProduct=e=>{e.addEventListener("change",t=>{const r=e.value.split(/(\\|\/)/g).pop();e.closest(".custom-file").querySelector("label").innerHTML=r;const o=document.querySelector(".productItemName");return putSpinnet(o.closest("form"),"insert"),formValidate([o]).then(t=>{const{invalids:r,valids:n}=t;return r.length?(putSpinnet(o.closest("form"),"remove"),e.value="",r.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")})):readFile(e.files[0]).then(e=>{const r=document.querySelector(".colapseCodes");r&&r.classList.add("show");const{invalids:n,valids:a}=t;return a.map(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")}),e.map(e=>{const t=createItem({prefix:o.value,code:e.text});if(!checkCodeInList(e.text))return putSpinnet(o.closest("form"),"remove"),Swal.fire({title:"O Código duplicado",text:`O Código ${e.text} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:e.text,name:o.value}),changeBadgeForm(codesInsert.length),r.querySelector(".card-body > .row").append(t)}),putSpinnet(o.closest("form"),"remove")}).catch(e=>(putSpinnet(o.closest("form"),"remove"),Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"})))})})},readFile=e=>new Promise((t,r)=>{const o=document.body.dataset.token,n=new FormData;n.append("file",e);const{type:a}=e;if("text/plain"!=a)return r("O tipo de arquivo deve ser .txt"),Swal.fire({title:"O tipo de arquivo deve ser .txt",text:"Selecione um arquivo com extensão txt",icon:"error",confirmButtonText:"Ok"});fetch("/api/file",{method:"POST",headers:{authorization:`Bearer ${o}`},body:n}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}),requestInsertProduct=e=>new Promise((t,r)=>{const{name:o,description:n,weight:a,brand:s,lot:c,type:i,excerpt:l,availability:d,items:u,image_id:m,categories:p}=e,h=document.body.dataset.token;if(!p.length)return r("Selecione ao menos 1 categoria");fetch("/api/product",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${h}`},body:JSON.stringify({name:o,description:n,weight:a,brand:s,lot:c,type:i,categories:p,availability:d,items:u,image_id:m})}).then(e=>e.json()).then(e=>e.error?r(e.error.replace(/(\r\n|\n|\r)/gm,"<br>")):(t(e),console.log(e))).catch(e=>r(e))}),productCreate=e=>{const t=e.querySelector(".productName"),r=e.querySelector(".productDescription"),o=e.querySelector(".productExcerpt"),n=e.querySelector(".productWeigth"),a=e.querySelector(".productBrand"),s=e.querySelector(".productLot"),c=e.querySelector(".productType"),i=e.querySelector(".productAvailability"),l=document.querySelector(".productItemName"),d=document.querySelector(".multCodes"),u=document.querySelector(".productCode"),m=document.querySelector(".fileToRead"),p=(imgProduct.images,document.querySelectorAll(".productCategory"));let h=[];if(p&&Array.from(p).forEach(e=>{e.checked&&h.push(parseInt(e.value))}),!h.length)return Swal.fire({title:"Selecione a categoria",text:"Por favor selecione ao menos 1 categoria",icon:"error",confirmButtonText:"Ok"});console.log("Categorias",h),e.classList.add("was-validated"),putSpinnet(e.closest("form"),"insert");const g=[t,n,a,s,c,i,l];return d.checked?g.push(m):g.push(u),formValidate(g).then(l=>{const{valids:d,invalids:u}=l;return u.length&&(putSpinnet(e.closest("form"),"remove"),u.forEach(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")})),codesInsert.length?(d.forEach(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")}),imgProduct.create().then(l=>requestInsertProduct({name:t.value,description:r.value,excerpt:o.value,weight:n.value,brand:a.value,lot:s.value,type:c.value,availability:i.value,items:codesInsert,categories:h,image_id:l}).then(t=>{if(t.error){const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t.error,e.prepend(r),setTimeout(()=>{r.remove()},4e3)}const r=e.querySelectorAll("input, textarea, .is-valid");return e.classList.remove("was-validated"),Array.from(r).forEach(e=>(e.value="",e.classList.remove("is-valid"))),putSpinnet(e.closest("form"),"remove"),Swal.fire({title:"Produto cadastrado",text:`O produto ${t.name} foi cadastrado com sucesso`,icon:"success",confirmButtonText:"Ok"})}).catch(t=>{const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t,e.prepend(r),putSpinnet(e.closest("form"),"remove"),setTimeout(()=>{r.remove()},4e3)}))):(putSpinnet(e.closest("form"),"remove"),Swal.fire({title:"Nenhum item cadastrado",text:"Por favor ensira ao menos 1 item no produto",icon:"error",confirmButtonText:"Ok"}))}).catch(e=>{console.log(e)})},btnInsertProduct=document.querySelector(".btnInsertProduct");btnInsertProduct&&btnInsertProduct.addEventListener("click",e=>{e.preventDefault(),productCreate(btnInsertProduct.closest("form"))});const switchMultCodes=document.querySelector(".multCodes");switchMultCodes&&switchMultCodes.addEventListener("change",function(e){!0===switchMultCodes.checked?(document.querySelector(".form-items-codes .custom-file-wrapper").classList.add("show"),document.querySelector(".form-items-codes .singleCode").classList.add("hide"),document.querySelector(".btnInsertItemProduct").disabled=!0):(document.querySelector(".form-items-codes .custom-file-wrapper").classList.remove("show"),document.querySelector(".form-items-codes .singleCode").classList.remove("hide"),document.querySelector(".btnInsertItemProduct").disabled=!1)}),btnClearCodes=document.querySelector(".btnCleamListProduct"),btnClearCodes&&btnClearCodes.addEventListener("click",e=>(e.preventDefault(),clearListItems()));const inputFileProduct=document.querySelector(".fileToRead");inputFileProduct&&changeFileProduct(inputFileProduct);const btnInsertItemProduct=document.querySelector(".btnInsertItemProduct");btnInsertItemProduct&&insertSingleCode(btnInsertItemProduct);const ImageProduct=document.querySelector(".productImage");ImageProduct&&imgProduct.change(ImageProduct);const profile=(()=>{const e=e=>(console.log(e.files),(e=>new Promise((t,r)=>{const o=document.body.dataset.token,n=new FormData;n.append("file",e),fetch("/api/user/image",{method:"PUT",headers:{authorization:`Bearer ${o}`},body:n}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(e.files[0]).then(e=>e.error?console.log(e.error):(document.querySelector(".img-profile").src=e.url,document.querySelector(".profile-avatar").src=e.url)).catch(e=>console.log(e))),t=e=>{if(!e)return console.log("Formulário não existe");Array.from(e.elements);const t={name:e.querySelector("#input-username").value,email:e.querySelector("#input-email").value,currentPassword:e.querySelector("#input-current-password").value,newPassword:e.querySelector("#input-new-password").value,address:e.querySelector("#input-address").value,city:e.querySelector("#input-city").value,phone:e.querySelector("#input-phone").value,cell:e.querySelector("#input-cell").value,about:e.querySelector("#textarea-about").value};return(e=>new Promise((t,r)=>{const o=document.body.dataset.token,{name:n,email:a,phone:s,cell:c,currentPassword:i,newPassword:l,address:d,about:u,city:m}=e;fetch("/api/user",{method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({name:n,email:a,phone:s,cell:c,currentPassword:i,newPassword:l,address:d,about:u,city:m})}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(t).then(e=>e.error?Swal.fire({title:"Erro ao atualizar usuário",text:e.error,icon:"error",confirmButtonText:"Ok"}):Swal.fire({title:"Perfil atualizado",text:`O Usuário ${e.name} foi atualizado com sucesso!`,icon:"success",confirmButtonText:"Ok"})).catch(e=>Swal.fire({title:"Erro ao atualizar usuário",text:e,icon:"error",confirmButtonText:"Ok"}))};return{edit:t=>{t.addEventListener("change",function(r){e(t)})},enableEdit:e=>{e||console.log("Botão não existe"),e.addEventListener("click",r=>{r.preventDefault();const o=document.querySelectorAll(".formEditUser input, .formEditUser textarea"),n=document.querySelector(".formEditUser");return e.classList.contains("save")?(Array.from(o).forEach(e=>{e.disabled=!0}),e.innerHTML="Edit profile",n&&t(n),e.classList.remove("save")):(Array.from(o).forEach(e=>{e.disabled=!1}),e.innerHTML="Salvar alterações",e.classList.add("save"))})},save:t}})(),inputEditAvatar=document.querySelector(".inputProfileAvatar");inputEditAvatar&&profile.edit(inputEditAvatar);const btnEditUser=document.querySelector(".btnEditUser");btnEditUser&&profile.enableEdit(btnEditUser);const search=(()=>{const e=e=>new Promise((t,r)=>{const{name:o,surname:n,email:a,code:s}=e;fetch("/api/search",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:o,surname:n,email:a,code:s,ip:ip,city:city,region:region})}).then(e=>e.json()).then(e=>(console.log(e),e.error?r(e.error):t(e))).catch(e=>r(e))});return{search:t=>{t.addEventListener("click",t=>{t.preventDefault(),console.log();const r=document.querySelector("input.Code"),o=document.querySelector("input.name"),n=document.querySelector("input.surname"),a=document.querySelector("input.mail");if(o&&n&&a)return(e=>new Promise((t,r)=>{e.map(e=>{const{input:o,msg:n}=e;return o.value?t():(o.setCustomValidity(n),o.reportValidity(),r(n))})}))([{input:o,msg:"Informe seu nome"},{input:n,msg:"Informe seu sobrenome"},{input:a,msg:"Informe seu e-mail"}]).then(t=>e({code:r.value,name:o.value,surname:n.value,email:a.value}).then(e=>{const{device:t,code:r,ip:o,city:n,address:a}=e;return document.querySelector(".clientInfo").innerHTML=`\n                            <p>\n                                <strong>Código: </strong> ${r.code}\n                            </p>\n                            <p>\n                                <strong>Produto: </strong> ${r.product.name}\n                            </p>\n                            <p>\n                                <strong>Item: </strong> ${r.item.name}\n                            </p>\n                            <p>\n                                <strong>Device: </strong> ${t}\n                            </p>\n                            <p>\n                                <strong>Cidade: </strong> ${n}\n                            </p>\n                            <p>\n                                <strong>Estado: </strong> ${a}\n                            </p>\n                            <p>\n                                <strong>Endereço IP: </strong> ${o}\n                            </p>\n                        `}).catch(e=>Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))})},show:e=>{e.addEventListener("click",t=>(t.preventDefault(),(e=>new Promise((t,r)=>{const o=document.body.dataset.token;fetch(`/api/search/${e}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${o}`}}).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}))(e.dataset.id).then(e=>{const t=new Intl.DateTimeFormat("pt-BR").format(new Date(e.createdAt));document.querySelector(".consultId").innerHTML=e.id,document.querySelector(".consultName").innerHTML=e.name,document.querySelector(".consultSurname").innerHTML=e.surname,document.querySelector(".consultMail").innerHTML=e.email,document.querySelector(".consultCity").innerHTML=e.city,document.querySelector(".consultAddress").innerHTML=e.address,document.querySelector(".consultCode").innerHTML=e.code.code,document.querySelector(".consultIp").innerHTML=e.ip,document.querySelector(".constData").innerHTML=t,$("#modalShowConsult").modal("show")})))}}})(),consults=document.querySelectorAll(".listConsults > tr");consults&&Array.from(consults).forEach(e=>{search.show(e)}),$(".page-adm-consults #dataTable").on("draw.dt",function(){const e=document.querySelectorAll(".listConsults > tr");e&&Array.from(e).forEach(e=>{search.show(e)})});const btnSearchCode=document.querySelector(".submitSearch");btnSearchCode&&search.search(btnSearchCode);const userResource="user",user={forgot:e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector("#input-forgot-email");t&&(e=>new Promise((t,r)=>{fetch("/api/forgot",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:e})}).then(e=>e.json()).then(e=>t(e)).catch(e=>r(e))}))(t.value).then(e=>e.erro?alert(e.erro):window.location.href="/login").catch(e=>console.log(e))})}},btnForgot=document.querySelector(".btnForgot");btnForgot&&user.forgot(btnForgot);const requestInsertAvatar=e=>new Promise((t,r)=>{const o=document.body.dataset.token,n=new FormData;n.append("file",e);fetch("/api/user/image",{method:"POST",headers:{authorization:`Bearer ${o}`},body:n}).then(e=>e.json()).then(e=>(console.log(e),t(e)))}),requestInsertUser=e=>new Promise((t,r)=>{const{name:o,email:n,password:a,phone:s,cell:c,type:i,image_id:l}=e,d=document.body.dataset.token;fetch("/api/user",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${d}`},body:JSON.stringify({name:o,email:n,password:a,phone:s,cell:c,type:i,image_id:l})}).then(e=>e.json()).then(e=>e.error?r(e.error):(t(e),console.log(e))).catch(e=>r(e))}),userCreate=e=>{const t=e.querySelector("input.userName"),r=e.querySelector(".userMail"),o=e.querySelector(".userPhone"),n=e.querySelector(".userCell"),a=e.querySelector(".userType"),s=e.querySelector(".userPassword"),c=e.querySelector(".inputUserImage");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),r.value?(r.classList.remove("is-invalid"),r.classList.add("is-valid"),o.value?(o.classList.remove("is-invalid"),o.classList.add("is-valid"),n.value?(n.classList.remove("is-invalid"),n.classList.add("is-valid"),s.value?(s.classList.remove("is-invalid"),s.classList.add("is-valid"),a.value?(a.classList.remove("is-invalid"),a.classList.add("is-valid"),requestInsertUser({name:t.value,email:r.value,phone:o.value,cell:n.value,type:a.value,password:s.value,image_id:c.value}).then(t=>{if(t.error){const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t.error,e.prepend(r),setTimeout(()=>{r.remove()},4e3)}const r=e.querySelectorAll("input, textarea, .is-valid");return e.classList.remove("was-validated"),Array.from(r).forEach(e=>(e.value="",e.classList.remove("is-valid"))),alert(`Usuário ${t.name} cadastrado!`)}).catch(t=>{const r=document.createElement("div");r.classList.add("alert","alert-danger"),r.setAttribute("role","alert"),r.innerHTML=t,e.prepend(r),setTimeout(()=>{r.remove()},4e3)})):a.classList.add("is-invalid")):s.classList.add("is-invalid")):n.classList.add("is-invalid")):o.classList.add("is-invalid")):r.classList.add("is-invalid")):t.classList.add("is-invalid")},inputImageUser=document.querySelector(".userFile");inputImageUser&&inputImageUser.addEventListener("change",e=>(console.log(inputImageUser.files[0]),requestInsertAvatar(inputImageUser.files[0]).then(e=>{document.querySelector(".insertUserAvatar").setAttribute("src",e.url),document.querySelector(".inputUserImage").value=e.id})));const btnInsertUser=document.querySelector(".btnCreateUser");btnInsertUser&&btnInsertUser.addEventListener("click",e=>{e.preventDefault(),userCreate(btnInsertUser.closest("form"))});const contact={create:e=>{e.addEventListener("submit",t=>{if(t.preventDefault(),e.checkValidity())return(e=>new Promise((t,r)=>{const{url:o,method:n,body:a,headers:s}=e,c={method:n||"GET",headers:{"content-type":s["content-type"]||null}};a&&(c.body=JSON.stringify(a)),console.log("Options request: ",c),fetch(o,c).then(e=>e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}))({url:"/api/contact",method:"POST",headers:{"content-type":"application/json"},body:{fullname:e.querySelector(".contactFullName").value,email:e.querySelector(".contactMail").value,subject:e.querySelector(".contactSubject").value,message:e.querySelector(".contactMessage").value}}).then(t=>{const r=[...e.elements];return e.classList.remove("was-validated"),r.map(e=>{e.value=""}),Swal.fire({title:"Sucesso!",text:`Foi solicitado um contato para ${t.email}`,icon:"success",confirmButtonText:"Ok"})}).catch(e=>(console.log(e),Swal.fire({title:"Erro!",text:e,icon:"error",confirmButtonText:"Ok"})))})}},formContact=document.querySelector(".form-contact");formContact&&contact.create(formContact);const consult=(()=>{const e=()=>new Promise((e,t)=>{fetch("https://ipapi.co/json/",{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.ok?e.json():t("Erro ao pesquisar codigo")).then(t=>e(t)).catch(e=>t(e))}),t=e=>new Promise((t,r)=>{const{email:o,code:n,ip:a,city:s,region:c}=e;fetch("/api/search",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:o,code:n,ip:a,city:s,region:c})}).then(e=>204===e.status?r({error:"Não encontrado",status:204}):e.json()).then(e=>e.error?r(e.error):t(e)).catch(e=>r(e))}),r=e=>{const t={};return new Promise((r,o)=>(e.map(e=>{const{input:r,msg:n}=e;if("BUTTON"!=r.tagName&&(!r.value||"Selecione..."==r.value))return r.setCustomValidity(n),r.reportValidity(),o(n);r.classList.contains("consultMail")&&(t.email=r.value),r.classList.contains("consultCode")&&(t.code=r.value)}),r(t)))};return{consult:o=>{o.addEventListener("submit",function(n){n.preventDefault();const a=Array.from(o.elements).map(e=>({input:e,msg:"Por favor preencha este campo"})),s=document.querySelector(".barCode");return r(a).then(r=>e().then(e=>{const{ip:n,city:a,region:c}=e;return t({code:r.code,ip:n,city:a,region:c,email:r.email}).then(e=>(s.innerHTML=e.code.code,$("#modalConsult").modal("show"),Array.from(o.elements).map(e=>{"BUTTON"!=e.tagName&&(e.value="")}))).catch(e=>{if(e.status)return s.innerHTML=r.code,$("#modalConsultError").modal("show");$("#modalErrValidation").modal("show")})}).catch(e=>Swal.fire({title:"Erro ao coletar informações se segurança",icon:"error",confirmButtonText:"Ok"}))).catch(e=>{console.log(e)})})}}})(),mobileMenu={dropdown:e=>{e.addEventListener("click",function(t){t.preventDefault(),console.log("cliquei"),e.closest("li").querySelector(".dropdown-menu").classList.toggle("show")})}},mobilteToggle=document.querySelectorAll("li > a.dropdown-toggle");Array.from(mobilteToggle).forEach(e=>{e&&mobileMenu.dropdown(e)});const overlay=document.querySelector(".mobile-back");overlay&&overlay.addEventListener("click",function(e){const t=document.querySelectorAll(".show");Array.from(t).forEach(e=>{e.classList.remove("show")})});const formConsultCode=document.querySelector(".formValidateCode");formConsultCode&&consult.consult(formConsultCode);