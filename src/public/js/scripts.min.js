const URL="http://192.168.0.10:3333/api",util=(()=>{const e=[];let t=0;image=((n,o,a,r)=>{n.addEventListener("change",s=>{s.preventDefault(),n.closest("form").classList.add("changed");const i={large:["my-2","col-12"],medium:["my-2","col-6"],small:["my-2","col-3"]};if(!r&&!i[r])return console.log("Informe o tamanho entre (large, medium e small)");const c=o,l=[...n.files],d=n.files[0];if(n.closest(".custom-file").querySelector("label").innerHTML=l.length+" imagens","mult"===a)l.map(n=>{const a=document.createElement("div");a.classList.add("mb-2","col-sm-3"),a.innerHTML='\n                    <img class="img-thumbnail" src="">\n                    ';const r=a.querySelector("img");if(FileReader&&n){var s=new FileReader;return s.onload=function(){r.src=s.result},s.readAsDataURL(n),e.push(n),r.dataset.index=e.indexOf(n),1===e.length&&r.classList.add("active"),((e,n)=>{e.addEventListener("click",o=>{const a=e.dataset.index;return allImages=n.querySelectorAll("img"),Array.from(allImages).forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),t=parseInt(a),console.log(t)})})(r,o),c.append(a)}});else{const t=document.createElement("div");t.classList.add(...i[r]),t.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const n=t.querySelector("img");if(FileReader&&d){var u=new FileReader;return u.onload=function(){n.src=u.result},u.readAsDataURL(d),e[0]=d,c.innerHTML="",c.append(t)}}})});const n=(e,t,o)=>{void 0===window.delayed_methods&&(window.delayed_methods={}),n[e]=Date.now();var a=n[e];setTimeout(function(){n[e]==a&&(n[e]="")},o||500)};return{image:image,images:e,request:e=>new Promise((t,n)=>{const o=document.body.dataset.token,{url:a,method:r,body:s,headers:i}=e,c={method:r||"GET",headers:{authorization:`Bearer ${o}`}};i&&(c.headers["content-type"]=i["content-type"]),i&&(c.headers.Accept=i.Accept),s&&(c.body=s),fetch(a,c).then(e=>e.json()).then(e=>e.error?n(e.error):t(e)).catch(e=>n(e))}),scroll:e=>{e.addEventListener("click",function(e){e.preventDefault(),document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth",block:"start"})})},validateSlug:e=>e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/ /g,"_"),newRequest:e=>new Promise((t,n)=>{const o=document.body.dataset.token,{url:a,method:r,body:s,headers:i}=e,c={method:r||"GET",headers:{authorization:`Bearer ${o}`}};i&&(c.headers["content-type"]=i["content-type"]),s&&(c.body=s),fetch(a,c).then(e=>e.json()).then(e=>e.error?n(e.error):t(e)).catch(e=>n(e))}),serialize:e=>{const t=[...e.elements],n={};return t.map((e,t)=>{if("radio"==e.type)return e.checked?n[e.name]=e.value:void 0;e.name&&(n[e.name]=e.value)}),n},resetForm:e=>{[...e.elements].map(e=>e.value="")},notify:e=>{const{icon:t,title:n,message:o,type:a}=e;return $.notify({icon:t,title:n,message:o},{type:a,template:'\n                <div data-notify="container" class="alert alert-dismissible alert-{0} alert-notify" role="alert">\n                    <span class="alert-icon" data-notify="icon"></span>\n                    <div class="alert-text"> \n                        <span class="alert-title" data-notify="title">{1}</span>\n                        <span data-notify="message">{2}</span>\n                    </div>\n                    <button type="button" class="close" data-notify="dismiss" aria-label="Close">\n                        <span aria-hidden="true">&times;</span>\n                    </button>\n                </div>\n                '})},get:e=>new Promise((t,n)=>{const o=document.body.dataset.token;fetch(e,{method:"GET",headers:{authorization:`Bearer ${o}`,"content-type":"application.json"}}).then(e=>e.json()).then(e=>e.error?n(e.error):t(e)).catch(e=>n(e))}),del:e=>new Promise((t,n)=>{const o=document.body.dataset.token;fetch(e,{method:"DELETE",headers:{authorization:`Bearer ${o}`,"content-type":"application.json"}}).then(e=>e.json()).then(e=>e.error?n(e.error):t(e)).catch(e=>n(e))}),delayed_methods:n,dateEnd:(e,t,n)=>{e.addEventListener("blur",o=>{const a=t.value,r=new Date(a);r.setMonth(r.getMonth()+parseInt(e.value));const s=r.toISOString().substr(0,10);console.log(s),n.value=s})},maskMoney:e=>{e.addEventListener("keyup",function(t){t.preventDefault(),$(e).maskMoney({prefix:"R$ "})})}}})(),inputStart=document.querySelector("input#locationStart"),inputEnd=document.querySelector("input#locationEnd"),inputMonth=document.querySelector("input#locationTime");inputStart&&inputEnd&&inputMonth&&util.dateEnd(inputMonth,inputStart,inputEnd);const allprods=document.querySelector(".nav-link.dropdown-toggle"),hoverMenu=document.querySelector(".nav-item.dropdown");if(hoverMenu&&(hoverMenu.onmouseover=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.add("show")}),hoverMenu.onmouseout=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.remove("show")})),allprods&&allprods.addEventListener("click",function(e){e.preventDefault(),url=allprods.getAttribute("href"),window.matchMedia("(min-width:800px)").matches&&(window.location.href=url)}),document.querySelector("input.cpf"))var cpf=new Cleave("input.cpf",{delimiters:[".",".","-"],blocks:[3,3,3,2],uppercase:!0});if(document.querySelector("input.rg"))var rg=new Cleave("input.rg",{delimiters:[".",".","-"],blocks:[2,3,3,1],uppercase:!0});if(document.querySelector("input.zipCode"))var cep=new Cleave("input.zipCode",{delimiters:["-"],blocks:[5,3],uppercase:!0});if(document.querySelector("input.phoneInput"))var phones=new Cleave("input.phoneInput",{phone:!0,phoneRegionCode:"BR"});if(document.querySelector("input#cell"))var cell=new Cleave("input#cell",{phone:!0,phoneRegionCode:"BR"});const cleaveMoney={numeral:!0,prefix:"R$ ",rawValueTrimPrefix:!0},inputsMoney=[...document.querySelectorAll("input.moneyValue")];if(inputsMoney&&inputsMoney.forEach(e=>util.maskMoney(e)),document.querySelector(".iptu"))var iptu=new Cleave("input#iptu",cleaveMoney);if(document.querySelector(".condominium"))var condominium=new Cleave("input#condominium",cleaveMoney);if(document.querySelector(".water"))var water=new Cleave("input#water",cleaveMoney);if(document.querySelector(".energy"))var energy=new Cleave("input#energy",cleaveMoney);if(document.querySelector(".trash"))var trash=new Cleave("input#trash",cleaveMoney);if(document.querySelector(".cleaningFee"))var cleaningFee=new Cleave("input#cleaningFee",cleaveMoney);if(document.querySelector(".othersValues"))var othersValues=new Cleave("input#othersValues",cleaveMoney);const btnValidat=document.querySelector(".btnAnchor");btnValidat&&util.scroll(btnValidat),function(){"use strict";window.addEventListener("load",function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(e){e.addEventListener("submit",t=>{!1===e.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")},!1)})},!1)}();const login={login:e=>{e.addEventListener("submit",t=>{t.preventDefault();const n=util.serialize(e);return util.request({url:"/api/login",method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n)}).then(e=>window.location.href="/dashboard").catch(e=>console.log(e))})},register:e=>{e.addEventListener("submit",function(t){t.preventDefault();const n=util.serialize(e),o=e.closest(".modal");return util.request({url:"/api/user",method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n)}).then(e=>{$(o).modal("hide"),$(o).on("hidden.bs.modal",function(t){return Swal.fire("Usuário criado",`Usuário ${e.name} criado com sucesso`,"success"),$(this).off("hidden.bs.modal")})}).catch(e=>util.notify({icon:"alert-icon ni ni-bell-55",title:"Atenção! alguns erros foram encontrados!",message:e,type:"warning"}))})}},formRegister=document.querySelector(".formRegister");formRegister&&login.register(formRegister);const formLogin=document.querySelector(".formLogin");formLogin&&login.login(formLogin);const product=(()=>{const e=$(".dataTable").DataTable(),t=e=>e.innerHTML='\n        <div class="spinner-border text-success" role="status">\n            <span class="sr-only">Loading...</span>\n        </div>',n=e=>{const t=document.createElement("tr"),n=document.querySelector(".productList"),{name:o,brand:a,price:r,stock:s,id:i,image:c,barcode:l}=e;t.innerHTML=`\n        <th scope="row">\n            <div class="media align-items-center">\n                <a href="#" class="avatar rounded-circle mr-3">\n                    ${c.url?`<img alt="Image placeholder" src="${c.url}">`:'<img alt="Image placeholder" src="https://via.placeholder.com/200">'}\n                </a>\n                <div class="media-body">\n                    <span class="name mb-0 text-sm">\n                        ${o} <br>\n                        <small>${l}</small>\n                    </span>\n                </div>\n            </div>\n        </th>\n        <td>\n            ${r}\n        </td>\n        <td>\n            ${a}\n        </td>\n        <td>\n            <i class="fas fa-arrow-up text-success mr-3"></i> ${s}\n        </td>\n        <td>\n            <button class="btn btn-warning" data-id="${i}"><i class="fas fa-trash-alt"></i></button>\n        </td>\n        `,n&&n.append(t)},o=t=>{t.addEventListener("click",function(n){n.preventDefault();const o=t.dataset.id,a=t.closest("tr");return util.del(`/api/product/${o}`).then(t=>(e.row($(a)).remove().draw(),Swal.fire("Excluído",`Produto ${t.name} excluído com sucesso`,"success")))})},a=e=>{e.addEventListener("click",function(t){const n=document.querySelector(e.dataset.target),o=e.dataset.id;n.dataset.id=o})},r=e=>(console.log(e),new Promise((t,n)=>{const{id:o}=e.data,a=e.form.elements.file.files[0];if(console.log(a),!a)return t(e.data);const r=new FormData;r.append("file",a),fetch(`/api/product_image/${o}`,{method:"POST",headers:{authorization:`Bearer ${document.body.dataset.token}`},body:r}).then(e=>e.json()).then(n=>{return util.resetForm(e.form),e.form.querySelector("button").innerHTML="Cadastrar Produto",t(n)}).catch(e=>n(e))}));return{create:e=>{e.addEventListener("submit",function(o){return o.preventDefault(),(e=>new Promise((n,o)=>{const a=e.querySelector("button");t(a);const r=util.serialize(e);util.request({url:"/api/product",method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r)}).then(t=>n({data:t,form:e})).catch(e=>o(e))}))(e).then(r).then(e=>(n(e),Swal.fire("Cadastrado",`Produto ${e.name} cadastrado com sucesso`,"success"))).catch(e=>util.notify({icon:"alert-icon ni ni-bell-55",title:"Atenção! alguns erros foram encontrados!",message:e,type:"warning"}))})},destroy:o,modal:e=>{$(e).on("show.bs.modal",function(t){const n=e.dataset.id,o=e.querySelector("form");console.log(o.elements.name),util.get(`/api/product/${n}`).then(e=>{const{name:t,price:n,brand:a,stock:r,id:s,barcode:i}=e;o.elements.name.value=t,o.elements.price.value=n,o.elements.brand.value=a,o.elements.stock.value=r,o.elements.barcode.value=i,o.dataset.id=s})})},openModal:a,update:t=>{t.addEventListener("submit",function(n){n.preventDefault();const r=t.dataset.id,s=util.serialize(t);return util.request({url:`/api/product/${r}`,method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify(s)}).then(n=>{const s=document.querySelector(`tr[data-id="${r}"]`);e.row($(s)).remove().draw();const i=t.closest(".modal");$(i).modal("hide"),$(i).on("hidden.bs.modal",function(t){const r=(t=>{const{name:n,price:o,brand:a,stock:r,barcode:s,id:i,image:c}=t,l=e.row.add([`\n                <div class="media align-items-center">\n                    <a href="#" class="avatar rounded-circle mr-3">\n                        ${c.url?`<img alt="Image placeholder" src="${c.url}">`:'<img alt="Image placeholder" src="https://via.placeholder.com/200">'}\n                    </a>\n                    <div class="media-body">\n                        <span class="name mb-0 text-sm">\n                            ${n} <br>\n                            <small>${s}</small>\n                        </span>\n                    </div>\n                </div>\n                `,o,a,`<i class="fas fa-arrow-up text-success mr-3"></i> ${r}`,`\n                <button class="btn btn-icon btn-primary editProduct" type="button" data-toggle="modal"\n                    data-target="#modalProduct" data-id="${i}">\n                    <span class="btn-inner--icon"><i class="fas fa-pencil-alt"></i></span>\n                </button>\n\n                <button class="btn btn-warning productDestroy" data-id="${i}">\n                    <i class="fas fa-trash-alt"></i>\n                </button>\n                `]).draw().node();return l.dataset.id=i,l.classList.add(`tr-product-${i}`),l.querySelector("td:last-child").classList.add("text-right"),l})(n);return a(r.querySelector(".editProduct")),o(r.querySelector(".productDestroy")),Swal.fire("Alterado",`Produto ${n.name} alterado com sucesso`,"success"),$(this).off("hidden.bs.modal")})}).catch(e=>util.notify({icon:"alert-icon ni ni-bell-55",title:"Atenção! alguns erros foram encontrados!",message:e,type:"warning"}))})}}})(),formEditProduct=document.querySelector(".formEditProduct");formEditProduct&&product.update(formEditProduct);const modalProd=document.querySelector("#modalProduct");modalProd&&product.modal(modalProd);const btnEditProduct=[...document.querySelectorAll(".editProduct")];btnEditProduct&&btnEditProduct.map(e=>product.openModal(e));const btnProductStore=document.querySelector(".productStore");btnProductStore&&product.create(btnProductStore);const btnProductDestroy=[...document.querySelectorAll(".productDestroy")];btnProductDestroy&&btnProductDestroy.map(e=>product.destroy(e));