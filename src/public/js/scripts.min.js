const URL="http://192.168.0.10:3333/api",util=(()=>{const e=[];let t=0;image=((o,r,n,a)=>{o.addEventListener("change",s=>{s.preventDefault(),o.closest("form").classList.add("changed");const c={large:["my-2","col-12"],medium:["my-2","col-6"],small:["my-2","col-3"]};if(!a&&!c[a])return console.log("Informe o tamanho entre (large, medium e small)");const i=r,l=[...o.files],d=o.files[0];if(o.closest(".custom-file").querySelector("label").innerHTML=l.length+" imagens","mult"===n)l.map(o=>{const n=document.createElement("div");n.classList.add("mb-2","col-sm-3"),n.innerHTML='\n                    <img class="img-thumbnail" src="">\n                    ';const a=n.querySelector("img");if(FileReader&&o){var s=new FileReader;return s.onload=function(){a.src=s.result},s.readAsDataURL(o),e.push(o),a.dataset.index=e.indexOf(o),1===e.length&&a.classList.add("active"),((e,o)=>{e.addEventListener("click",r=>{const n=e.dataset.index;return allImages=o.querySelectorAll("img"),Array.from(allImages).forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),t=parseInt(n),console.log(t)})})(a,r),i.append(n)}});else{const t=document.createElement("div");t.classList.add(...c[a]),t.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const o=t.querySelector("img");if(FileReader&&d){var u=new FileReader;return u.onload=function(){o.src=u.result},u.readAsDataURL(d),e[0]=d,i.innerHTML="",i.append(t)}}})});return{image:image,images:e,request:(e,t,o,r,n)=>new Promise((a,s)=>{const c=`Bearer ${document.body.dataset.token}`,i={};n&&(i["content-type"]=n);const l=r||null;o&&(i.authorization=c),fetch(`/api/${e}`,{method:t,headers:i,body:l}).then(e=>e.json()).then(e=>e.error?s(e.error):a(e)).catch(e=>s(e))}),scroll:e=>{e.addEventListener("click",function(e){e.preventDefault(),document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth",block:"start"})})}}})(),allprods=document.querySelector(".nav-link.dropdown-toggle"),hoverMenu=document.querySelector(".nav-item.dropdown");hoverMenu&&(hoverMenu.onmouseover=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.add("show")}),hoverMenu.onmouseout=(()=>{document.querySelector(".nav-item.dropdown > ul").classList.remove("show")})),allprods&&allprods.addEventListener("click",function(e){e.preventDefault(),url=allprods.getAttribute("href"),window.matchMedia("(min-width:800px)").matches&&(window.location.href=url)});const btnValidat=document.querySelector(".btnAnchor");btnValidat&&util.scroll(btnValidat),function(){"use strict";window.addEventListener("load",function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(e){e.addEventListener("submit",t=>{!1===e.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")},!1)})},!1)}();const carousel=(()=>{const e=$("#dataTable").DataTable(),t=t=>{t.addEventListener("click",async r=>{r.preventDefault();try{const r=t.dataset.id,n=await o({url:`/api/carousel/${r}`,method:"DELETE"});console.log(n),e.row($(t.closest("tr"))).remove().draw()}catch(e){console.log(e)}})},o=e=>new Promise((t,o)=>{const r=document.body.dataset.token,{url:n,method:a,body:s,headers:c}=e,i={method:a||"GET",headers:{authorization:`Bearer ${r}`}};c&&(i.headers["content-type"]=c["content-type"]),s&&(i.body=s),console.log("Options request: ",i),fetch(n,i).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))});return{change:e=>{const t=document.querySelector(".carouselImageContainer");util.image(e,t,"single","large")},create:r=>{r.addEventListener("submit",n=>{n.preventDefault();const a=r.querySelector(".carouselImage").files[0];if(r.checkValidity()){const n=new FormData;return n.append("file",a),o({url:"/api/carousel/image",method:"POST",body:n}).then(n=>(console.log(n),o({url:"/api/carousel",method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:r.querySelector(".carouselName").value,image_id:n.id})}).then(o=>{console.log(o),listInput=[...r.elements],listInput.map(e=>e.value="");const n=e.row.add([o.id,o.name,`<img src="${o.image.url}" alt="..." class="img-thumbnail" style="max-width: 120px;">`,o.createdAt,`<button type="button"\n                                            class="btn btn-datatable btn-icon btn-transparent-dark carouselDestroy py-0"\n                                            data-id="${o.id}">\n\n                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"\n                                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"\n                                                stroke-linejoin="round" class="feather feather-trash-2">\n                                                <polyline points="3 6 5 6 21 6"></polyline>\n                                                <path\n                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">\n                                                </path>\n                                                <line x1="10" y1="11" x2="10" y2="17"></line>\n                                                <line x1="14" y1="11" x2="14" y2="17"></line>\n                                            </svg>\n                                        </button>\n                                        `]).draw().node();$("#modalCarousel").modal("hide");const a=n.querySelector(".carouselDestroy");return a&&t(a),Swal.fire({title:"Sucesso!",text:"Imagem criada com sucesso!",icon:"success",confirmButtonText:"Ok"})}).catch(e=>console.log(e)))).catch(e=>Swal.fire({title:"Erro",text:e,icon:"error",confirmButtonText:"Ok"}))}})},destroy:t}})(),carouselDestroy=document.querySelectorAll(".carouselDestroy");carouselDestroy&&Array.from(carouselDestroy).forEach(e=>{carousel.destroy(e)});const carouselImage=document.querySelector(".carouselImage"),carouselForm=document.querySelector(".carouselForm");carouselForm&&carousel.create(carouselForm),carouselImage&&carousel.change(carouselImage);const category=(()=>{const e=$("#dataTable").DataTable(),t=(t,r)=>{o(r).then(o=>(e.row($(t.closest("tr"))).remove().draw(),Swal.fire({title:`Categoria ${o.name} removida com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:e,text:"Ocorreu um erro ao remover a categoria",icon:"error",confirmButtonText:"Ok"}))},o=e=>new Promise((t,o)=>{const r=document.body.dataset.token;fetch(`/api/category/${e}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${r}`}}).then(e=>e.ok?e.json():o("Erro ao deletar categoria")).then(e=>t(e)).catch(e=>o(e))}),r=e=>(e=>{const o=e.dataset.id;e.addEventListener("click",r=>(r.preventDefault(),t(e,o)))})(e),n=t=>{t.addEventListener("click",o=>{const r=t.dataset.id,n=document.querySelector(".btnEditCategory");return(e=>new Promise((t,o)=>{const r=document.body.dataset.token;fetch(`/api/category/${e}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${r}`}}).then(e=>e.json()).then(e=>t(e)).catch(e=>o(e))}))(r).then(t=>{const o=document.querySelector(".editCategoryName"),r=document.querySelector(".editCategoryDescription"),a=document.querySelector(".editCategorySlug"),s=document.querySelector(".editCategoryParent"),{id:c,name:i,description:l,slug:d,parent:u}=t;return s.querySelector(`option[value="${u}"]`)&&(s.querySelector(`option[value="${u}"]`).selected=!0),o.value=i,r.value=l,a.value=d,n.addEventListener("click",t=>(e=>new Promise((t,o)=>{const r=document.body.dataset.token,{id:n,name:a,description:s,slug:c,parent:i}=e;fetch(`/api/category/${n}`,{method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${r}`},body:JSON.stringify({name:a,description:s,slug:c,parent:i})}).then(e=>e.ok?e.json():o("Erro ao criar categoria")).then(e=>t(e)).catch(e=>o(e))}))({id:c,name:o.value,description:r.value,slug:a.value,parent:s.value||null}).then(t=>(t=>{const{id:o,name:r,description:n,slug:a,parent:s,createdAt:c}=t,i=document.querySelector(`.category-${o}`);if(i){i.querySelector("td:nth-child(2)"),i.querySelector("td:nth-child(3)"),i.querySelector("td:nth-child(5)");let t=new Date(c);t=new Intl.DateTimeFormat("pt-BR").format(t);let o=e.row($(i)).data();return console.log(i),o[1]=r,o[2]=n,e.row($(i)).data(o).draw(),Swal.fire({title:`Categoria ${r} editada com sucesso!`,icon:"success",confirmButtonText:"Ok"})}})(t)))}).catch(e=>Swal.fire({title:"Erro ao editar categoria",icon:"error",confirmButtonText:"Ok"}))})};return{destroy:r,create:t=>{t.addEventListener("click",t=>{t.preventDefault();const o=document.querySelector(".categoryName"),a=document.querySelector(".categoryDescription"),s=document.querySelector(".categorySlug"),c=document.querySelector(".categoryParent");return(e=>new Promise((t,o)=>{e.map(e=>{const{input:r,msg:n}=e;return console.log(),r.value&&"Selecione..."!=r.value?t():(r.setCustomValidity(n),r.reportValidity(),o(n))})}))([{input:o,msg:"Informe um nome para a categoria"}]).then(()=>(e=>new Promise((t,o)=>{const r=document.body.dataset.token,{name:n,description:a,slug:s,parent:c}=e;fetch("/api/category",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${r}`},body:JSON.stringify({name:n,description:a,slug:s,parent:c})}).then(e=>e.json()).then(e=>{if(e.error)return o(e.error);t(e)}).catch(e=>o(e))}))({name:o.value,description:a.value,slug:s.value,parent:c.value||null}).then(t=>((t=>{const{id:o,name:a,description:s,createdAt:c}=t;let i=new Date(c);i=new Intl.DateTimeFormat("pt-BR").format(i);const l=e.row.add([o,a,s,0,`\x3c!-- Botão de ação Editar // --\x3e\n            <button type="button" class="btn btn-datatable btn-icon btn-transparent-dark editCategory py-0" data-toggle="modal" data-target="#modalEditCategory" data-id="${o}">\n                <i class="fas fa-edit"></i>\n            </button>\n            \x3c!-- Botão de ação Editar // --\x3e\n            <button type="button" class="btn btn-datatable btn-icon btn-transparent-dark categoryDestroy py-0" data-id="${o}">\n                <i class="far fa-trash-alt"></i>\n            </button>`]).draw().node();l.classList.add(`category-${o}`);const d=l.querySelector(".editCategory");n(d);const u=l.querySelector(".categoryDestroy");r(u)})(t),Swal.fire({title:`Categoria ${t.name} criada com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))})},edit:n}})(),btnCategoryDestroy=document.querySelectorAll(".categoryDestroy");btnCategoryDestroy&&Array.from(btnCategoryDestroy).forEach(e=>category.destroy(e));const btnModalEditCategory=document.querySelectorAll(".editCategory");btnModalEditCategory&&Array.from(btnModalEditCategory).forEach(e=>category.edit(e));const btnCreateCategory=document.querySelector(".btnCreateCategory");btnCreateCategory&&category.create(btnCreateCategory);const loginResource="login",requestLogin=e=>new Promise((t,o)=>{const{email:r,password:n,gToken:a}=e;fetch("/api/login",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:r,password:n,gToken:a})}).then(e=>e.json()).then(e=>e.error?o(e.error):(t(e),console.log(e))).catch(e=>o(e))}),login=e=>{const t=e.querySelector(".loginMail"),o=e.querySelector(".loginPassword");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),o.value?void grecaptcha.ready(function(){grecaptcha.execute("6LeM9q0ZAAAAAPJ827IgGMXdYRB9NdnNkbfrmaEY",{action:"login"}).then(function(r){return requestLogin({email:t.value,password:o.value,gToken:r}).then(e=>{window.location.href="/dashboard"}).catch(t=>{const o=document.createElement("div");o.classList.add("alert","alert-danger"),o.setAttribute("role","alert"),o.innerHTML=t,e.prepend(o),setTimeout(()=>{o.remove()},4e3)})})}):o.classList.add("is-invalid")):t.classList.add("is-invalid")},btnLogin=document.querySelector(".btnLogin");btnLogin&&btnLogin.addEventListener("click",e=>{e.preventDefault(),login(btnLogin.closest("form"))});const page=(()=>{const e=e=>e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/ /g,"_"),t=e=>{const t={},o={},r="Preencha este campo";return new Promise((n,a)=>(e.map(e=>{const n=e;if(!(n.classList.contains("pageSlug")||"BUTTON"==n.tagName||n.value&&"Selecione..."!=n.value))return n.setCustomValidity(r),n.reportValidity(),a(r);n.classList.contains("pageTitle")&&(t.title=n.value),n.classList.contains("pageContent")&&(t.content=n.value),n.classList.contains("pageSlug")&&(t.slug=n.value),n.classList.contains("bannerTitle")&&(o.title=n.value),n.classList.contains("bannerPosition")&&(o.position=n.value),n.classList.contains("bannerDescription")&&(o.description=n.value)}),(e=>{for(var t in e)if(e.hasOwnProperty(t))return!1;return!0})(o)||(t.banner=o),n(t)))},o=(e,o)=>{const r=[...e.elements];return t(r).then(e=>(e=>new Promise((t,o)=>{const{title:r,slug:n,content:a}=e,s=`Bearer ${document.body.dataset.token}`;fetch("/api/page",{method:"POST",headers:{"content-type":"application/json",authorization:s},body:JSON.stringify({title:r,slug:n,content:a})}).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}))(e).then(e=>((e=>{const{title:t,slug:o}=e,r=document.querySelector("#collapsePages > div"),n=document.querySelector("#collapsePages > div .collapse-divider"),a=document.createElement("a");a.classList.add("collapse-item"),a.setAttribute("href",`/page/${o}`),a.innerHTML=t,r.insertBefore(a,n)})(e),Swal.fire({title:"Página criada",text:`A página ${e.title} foi criada com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Erro ao criar página",text:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))};return{create:t=>{const r=t.closest("form");(t=>{const o=t.querySelector(".pageTitle"),r=t.querySelector(".pageSlug");let n=!0;n&&o.addEventListener("keyup",t=>{r.value=e(o.value)}),r.addEventListener("keyup",t=>{r.value=e(r.value),n=!1})})(r),t.addEventListener("click",e=>(e.preventDefault(),o(r)))},update:(e,o,r)=>{e.addEventListener("submit",async n=>{n.preventDefault(),console.log("Banners",o);const a=[...e.elements],s={},c=new FormData;if(c.append("file",o[0]),o){if(!r)return console.log("Nenhum formulário de banner inserido");const e=[...r.elements];if(r.classList.contains("changed")){const o=await t(e),r=await util.request("banner-image","POST",!0,c);if(!o)return console.log("Erro na validação do banner");s.banner={image_id:r.id,title:o.banner.title,position:o.banner.position,description:o.banner.description}}}const i=e.querySelector("button").dataset.id;return t(a).then(e=>{const{slug:t,content:o}=e;return s.id=i,s.slug=t,s.content=o,(e=>new Promise((t,o)=>{const{slug:r,content:n,banner:a}=e,s=`Bearer ${document.body.dataset.token}`;fetch(`/api/page/${e.id}`,{method:"PUT",headers:{"content-type":"application/json",authorization:s},body:JSON.stringify({slug:r,content:n,banner:a})}).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}))(s).then(e=>(r&&r.classList.remove("changed"),Swal.fire({title:"Página Atualizada",text:`A página ${e.title} foi atualizada com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Erro ao atualizar página página",text:e,icon:"error",confirmButtonText:"Ok"}))}).catch(e=>console.log(e))})}}})(),banner={create:e=>{e.addEventListener("submit",function(t){t.preventDefault();const o=e.querySelector("button").dataset.id;return(e=>{const t={};return new Promise((o,r)=>(e.map(e=>{const{input:o,msg:n}=e;if(!(o.classList.contains("pageSlug")||o.value&&"Selecione..."!=o.value))return o.setCustomValidity(n),o.reportValidity(),r(n);o.classList.contains("pageTitle")&&(t.title=o.value),o.classList.contains("pageContent")&&(t.content=o.value),o.classList.contains("pageSlug")&&(t.slug=o.value)}),console.log(t),o(t)))})(Array.from(e.elements).map(e=>{if("BUTTON"!=e.tagName)return{input:e,msg:"Preencha este campo"}})).then(e=>(e=>new Promise((t,o)=>{const{title:r,position:n,description:a,page_id:s}=e,c=`Bearer ${document.body.dataset.token}`;fetch(`/api/banner/${s}`,{method:"POST",headers:{"content-type":"application/json",authorization:c},body:JSON.stringify({title:r,position:n,description:a})}).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}))({page_id:o,title:e.title,position:e.position,description:e.description}).then(e=>Swal.fire({title:"Banner criado",text:`O banner ${e.title} foi criado com sucesso!`,icon:"success",confirmButtonText:"Ok"})).catch(e=>Swal.fire({title:"Erro ao criar Banner",text:e,icon:"error",confirmButtonText:"Ok"})))})}},btnAddPage=document.querySelector(".btnCreateNewPage");btnAddPage&&page.create(btnAddPage);const updatePageForm=document.querySelector(".updatePageForm"),formBanner=document.querySelector(".formBanner");updatePageForm&&formBanner&&page.update(updatePageForm,util.images,formBanner);const bannerImage=document.querySelector(".bannerImage"),bannersContainer=document.querySelector(".bannersContainer");bannerImage&&bannersContainer&&util.image(bannerImage,bannersContainer,"single","large");const newsletter={subscribe:e=>{e.addEventListener("submit",function(t){return t.preventDefault(),(e=>{const t={};return new Promise((o,r)=>(e.map(e=>{const{input:o,msg:n}=e;if(console.log(o.value),"BUTTON"!=o.tagName&&(!o.value||"Selecione..."==o.value))return o.setCustomValidity(n),o.reportValidity(),r(n);o.classList.contains("subName")&&(t.name=o.value),o.classList.contains("subEmail")&&(t.email=o.value)}),o(t)))})(Array.from(e.elements).map(e=>({input:e,msg:"Por favor preencha este campo"}))).then(e=>(e=>{const{name:t,email:o}=e;return new Promise((e,r)=>{fetch("/api/subscriber",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,email:o})}).then(e=>e.json()).then(t=>t.error?r(t.error):e(t)).catch(e=>r(e))})})(e).then(t=>Swal.fire({title:"Cadastrado com sucesso!",text:`Olá ${e.name} você se cadastrou com sucesso em nossa newsletter`,icon:"success",confirmButtonText:"Ok"})).catch(e=>Swal.fire({title:"Erro ao cadastrar-se",text:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))})}},newsForm=document.querySelector(".newsForm");newsForm&&newsletter.subscribe(newsForm);const partner=(()=>{const e=$("#dataTable").DataTable(),t=e=>new Promise((t,o)=>{const r=document.body.dataset.token,{url:n,method:a,body:s,headers:c}=e,i={method:a||"GET",headers:{authorization:`Bearer ${r}`,"content-type":c["content-type"]||null}};s&&(i.body=JSON.stringify(s)),console.log("Options request: ",i),fetch(n,i).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}),o=o=>{o.addEventListener("click",r=>{r.preventDefault();const n=o.dataset.id;return t({url:`/api/partner/${n}`,method:"DELETE",headers:{"content-type":"application/json"}}).then(t=>(e.row($(o.closest("tr"))).remove().draw(),Swal.fire({title:"Sucesso!",text:`Parceiro ${t.title} deletado com sucesso!`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Erro!",text:e,icon:"error",confirmButtonText:"Ok"}))})};return{create:r=>{const n=r.querySelector('input[type="file"]');n&&(e=>{e.addEventListener("change",t=>{const o=e.value.split(/(\\|\/)/g).pop();e.closest(".custom-file").querySelector("label").innerHTML=o;const r=document.querySelector(".imagePartner"),n=[...e.files];console.log("Lista de imagens",n),n.map(t=>{if("image/png"!=t.type)return e.value="",Swal.fire({title:"Imagem invlálida",text:"A imagem deve ser no formato png",icon:"error",confirmButtonText:"Ok"});const o=document.createElement("div");o.classList.add("mb-2","col-12"),o.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const n=o.querySelector("img");if(FileReader&&t){var a=new FileReader;return a.onload=function(){n.src=a.result},a.readAsDataURL(t),r.innerHTML="",r.append(o)}})})})(n),r.addEventListener("submit",n=>{if(n.preventDefault(),r.checkValidity()){putSpinnet(r,"insert");const n={title:r.querySelector(".partnerTitle").value,company:r.querySelector(".partnerCompany").value,content:r.querySelector(".partnerContent").value},a={url:"/api/partner",method:"POST",headers:{"content-type":"application/json"},body:{title:n.title,company:n.company,content:n.content}};return t(a).then(t=>{const{title:n,company:a,id:s,createdAt:c}=t,i=[...r.elements];r.classList.remove("was-validated"),document.querySelector(".imagePartner").innerHTML="",i.map(e=>{e.value=""});const l=new Intl.DateTimeFormat("pt-BR").format(new Date(c)),d=e.row.add([s,n,a,l,`<button type="button"\n                                    class="btn btn-datatable btn-icon btn-transparent-dark partnerDestroy py-0"\n                                    data-id="${s}">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"\n                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"\n                                        stroke-linejoin="round" class="feather feather-trash-2">\n                                        <polyline points="3 6 5 6 21 6"></polyline>\n                                        <path\n                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">\n                                        </path>\n                                        <line x1="10" y1="11" x2="10" y2="17"></line>\n                                        <line x1="14" y1="11" x2="14" y2="17"></line>\n                                    </svg>\n                                </button>`]).draw().node(),u=d.querySelector("button");return o(u),console.log("Criated Partner: ",d),putSpinnet(r,"remove"),Swal.fire({title:"Sucesso!",text:`Parceiro ${n} criado com sucesso!`,icon:"success",confirmButtonText:"Ok"})}).catch(e=>(putSpinnet(r,"remove"),Swal.fire({title:"Erro",text:e,icon:"error",confirmButtonText:"Ok"})))}})},destroy:o}})(),formPartner=document.querySelector(".partnerForm"),partnerDestroy=document.querySelectorAll(".partnerDestroy");formPartner&&partner.create(formPartner),partnerDestroy&&Array.from(partnerDestroy).forEach(e=>{partner.destroy(e)});const btnsProduct=document.querySelectorAll(".productDelete"),requestDeleteProduct=e=>new Promise((t,o)=>{const r=document.body.dataset.token;fetch(`/api/product/${e}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${r}`}}).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))});btnsProduct&&Array.from(btnsProduct).forEach(e=>{e.addEventListener("click",t=>{const o=e.dataset.product;requestDeleteProduct(o).then(t=>(e.closest(".col-12").remove(),Swal.fire({title:"Produto excluido com sucesso!",text:`O produto ${t.name} foi excluído`,icon:"success",confirmButtonText:"Ok"}))).catch(e=>Swal.fire({title:"Arro ao remover produto",text:e,icon:"error",confirmButtonText:"Ok"}))})});const productResource="product";let codesInsert=[],productImages=[];const imgProduct=(()=>{const e=[],t=[];let o=0;const r=e=>{e.addEventListener("click",t=>{const r=e.dataset.index;return allImages=e.closest(".imagesProductContainer").querySelectorAll("img"),Array.from(allImages).forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),o=parseInt(r),console.log(o)})};return{create:()=>new Promise(async(o,r)=>{const n=document.body.dataset.token,a=e.map(async e=>{const o=new FormData;return o.append("file",e),e=await fetch("/api/image/product",{method:"POST",headers:{authorization:`Bearer ${n}`},body:o}).then(e=>e.json()).then(e=>e.error?r(e.error):(t.push(e.id),e)).catch(e=>r(e)),await e[0]}),s=await Promise.all(a);return console.log("Resultado retornado: ",s),o(s)}),change:t=>{t.addEventListener("change",o=>{o.preventDefault();const n=document.querySelector(".imagesProductContainer"),a=[...t.files];t.closest(".custom-file").querySelector("label").innerHTML=a.length+" imagens",console.log("Lista de imagens",a),a.map(t=>{const o=document.createElement("div");o.classList.add("mb-2","col-sm-3"),o.innerHTML='\n                <img class="img-thumbnail" src="">\n                ';const a=o.querySelector("img");if(FileReader&&t){var s=new FileReader;return s.onload=function(){a.src=s.result},s.readAsDataURL(t),e.push(t),a.dataset.index=e.indexOf(t),1===e.length&&a.classList.add("active"),r(a),n.append(o)}})})},images:t,default:r}})(),product=(()=>{let e=[];const t=e=>new Promise((t,o)=>{const r=document.body.dataset.token,{url:n,method:a,body:s,headers:c}=e,i={method:a||"GET",headers:{authorization:`Bearer ${r}`}};c&&(i.headers["content-type"]=c["content-type"]),s&&(i.body=s),fetch(n,i).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}),o=(e,o)=>new Promise(async(r,n)=>{if(!o.value)return n("Nenhuma imagem selecionada");{const a=[...o.files],s=new FormData;a.map(e=>s.append("file",e));try{return r(await t({url:`/api/image/product/${e}`,method:"POST",body:s}))}catch(e){return n(e)}}}),r=e=>{e.addEventListener("click",t=>(t.preventDefault(),e.closest("div").style.display="none",n(e).then(t=>{e.closest(".mb-2.col-sm-3").remove()}).catch(t=>{e.closest("div").style.display="none",console.log(t)})))},n=e=>new Promise(async(o,r)=>{const n=e.dataset.id;if(!n)return r("Faltam parametros na imagem");try{return o(await t({url:`/api/image/product/${n}`,method:"DELETE"}))}catch(e){return r(e)}});return{update:n=>{n.addEventListener("submit",async a=>{if(a.preventDefault(),n.checkValidity())try{const a=n.dataset.id,s=n.querySelector(".productName").value,c=n.querySelector(".productDescription").value,i=n.querySelector(".productWeight").value,l=n.querySelector(".productLot").value,d=n.querySelector(".productType").value,u=n.querySelector(".productAvailability").value,m=n.querySelector(".productBrand").value,p=n.querySelector(".productExcerpt").value,y=document.querySelectorAll(".productCategory:checked"),h=n.querySelector(".productImages"),g=document.querySelectorAll(".listItensProduct > div"),f=[...y];if(!f.length)return Swal.fire({title:"Selecione uma categoria",icon:"error",confirmButtonText:"Ok"});if(h.value){const e=await o(a,h),t=document.querySelector(".imagesProductContainer");e&&e.map(e=>{const o=document.createElement("div");o.classList.add("mb-2","col-sm-3"),o.innerHTML=`\n                                <button class="btn btn-danger btn-sm" data-id="${e.id}" data-product="${e.product_id}">\n                                    <i class="far fa-trash-alt"></i>\n                                </button>\n                                <img class="img-thumbnail ${e.default?"active":""}" src="${e.url}" data-index="0">\n                                `,r(o.querySelector("button")),t.append(o)})}await(e=>new Promise(async(t,o)=>[...e].length?t(e):o("Nenhum item selecionado")))(g);const v=await t({url:`/api/product/${a}`,method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({name:s,description:c,weight:i,lot:l,type:d,availability:u,brand:m,excerpt:p,items:e,category:f.map(e=>parseInt(e.value))})});return Swal.fire({title:"Produto atualizado com sucesso",text:`O produto ${v.name} foi atualizado com sucesso!`,icon:"success",confirmButtonText:"Ok"})}catch(e){return Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"})}})},imgDestroy:r,fileChange:t=>{const o=t.closest("form");t.addEventListener("change",async r=>{const n=t.files[0];if(r.preventDefault(),console.log(n),!o.querySelector(".productItemName").value)return t.value="",Swal.fire({title:"Informe um nome para os itens",icon:"error",confirmButtonText:"Ok"});try{if("text/plain"!=n.type)return Swal.fire({title:"Tipo inválido",icon:"error",confirmButtonText:"Ok"});((t,o,r)=>{t.map(t=>{document.createElement("div"),e.push({name:o,code:t.text})})})(await readFile(n),o.querySelector(".productItemName").value,document.querySelector(".listItensProduct")),console.log(e)}catch(e){console.log(e)}})},codesClear:()=>{e=[]},codeDestroy:o=>{o.addEventListener("click",async r=>{try{if(o.classList.contains("raiz")){const r=o.dataset.id;await t({url:`/api/code/${r}`,method:"DELETE"}),o.closest(".col-12.mb-3").remove(),console.log(e)}else{const t=o.dataset.code,r=codesInsert.find(e=>e.code===t);let n=e.indexOf(r);e.splice(n,1),o.closest(".col-12.mb-3").remove(),console.log(e)}}catch(e){}})},codeRemove:t=>{const o=codesInsert.find(e=>e.code===t);let r=e.indexOf(o);e.splice(r,1)}}})(),listCodes=document.querySelectorAll(".listItensProduct > div button");listCodes&&Array.from(listCodes).forEach(e=>product.codeDestroy(e));const fileToRead=document.querySelector(".form-edit-product-codes .fileToRead");fileToRead&&product.fileChange(fileToRead);const formEditProduct=document.querySelector(".editProduct"),imagesProduct=document.querySelectorAll(".editProduct .imagesProductContainer > div button");imagesProduct&&Array.from(imagesProduct).forEach(e=>product.imgDestroy(e)),formEditProduct&&product.update(formEditProduct);const clearListItems=()=>{codesInsert=[],product.codesClear();const e=document.querySelectorAll(".colapseCodes > div > .row > div");if(e)return Array.from(e).forEach(e=>{if(e)return e.remove()}),document.querySelector(".headerListItem span.badge,badge-primary").innerHTML=codesInsert.length},putSpinnet=(e,t)=>{const o=document.createElement("div");return o.classList.add("spinner-border","text-primary","float-right"),o.setAttribute("role","status"),o.innerHTML='<span class="sr-only">Loading...</span>',"insert"===t?e.append(o):"remove"===t&&e.querySelector(".spinner-border")?e.querySelector(".spinner-border").remove():void 0},changeBadgeForm=e=>{const t=document.querySelector(".colapseCodes"),o=t.closest(".accordion").querySelector(".card-header .badge");if(t)return o.innerHTML=e},removeCodeForm=e=>{e.addEventListener("click",t=>{const o=e.dataset.code,r=codesInsert.find(e=>e.code===o);if(product.codeRemove(o),r){let t=codesInsert.indexOf(r);return codesInsert.splice(t,1),e.closest(".col-12").remove(),changeBadgeForm(codesInsert.length)}console.log("código não esta presente")})},checkCodeInList=e=>!codesInsert.find(t=>t.code===e),createItem=e=>{const{prefix:t,code:o}=e,r=document.createElement("div");return r.classList.add("col-12","mb-3"),r.innerHTML=`\n    <div class="card">\n        <div class="card-header">\n            ${t}\n            <button type="button" class="float-right btn btn-danger btn-sm" data-code="${o}"><i class="fas fa-trash-alt"></i></button>\n        </div>\n        <div class="card-body">\n        ${o}\n        </div>\n    </div>\n    `,removeCodeForm(r.querySelector("button")),r},formValidate=e=>new Promise((t,o)=>{if("object"!=typeof e)return o("O parametro deve ser um array");const r=e.filter(e=>{if(!e.value)return e});return t({valids:e.filter(e=>{if(e.value)return e}),invalids:r})}),insertSingleCode=e=>{e.addEventListener("click",t=>{if(t.preventDefault(),e.disabled)return!1;const o=e.closest("form");putSpinnet(o,"insert");const r=o.querySelector(".productItemName"),n=o.querySelector(".productCode");return formValidate([r,n]).then(e=>{const{valids:t,invalids:a}=e;if(a.length)return a.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")});if(!checkCodeInList(n.value))return putSpinnet(o,"remove"),Swal.fire({title:"O Código duplicado",text:`O Código ${n.value} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:n.value,name:r.value});const s=createItem({prefix:r.value,code:n.value}),c=document.querySelector(".colapseCodes");return c?(c.querySelector(".card-body > .row").append(s),changeBadgeForm(codesInsert.length),putSpinnet(o,"remove"),c.classList.add("show")):void 0})})},changeFileProduct=e=>{e.addEventListener("change",t=>{const o=e.value.split(/(\\|\/)/g).pop();e.closest(".custom-file").querySelector("label").innerHTML=o;const r=document.querySelector(".productItemName");return putSpinnet(r.closest("form"),"insert"),formValidate([r]).then(t=>{const{invalids:o,valids:n}=t;return o.length?(putSpinnet(r.closest("form"),"remove"),e.value="",o.map(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")})):readFile(e.files[0]).then(e=>{const o=document.querySelector(".colapseCodes");o&&o.classList.add("show");const{invalids:n,valids:a}=t;return a.map(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")}),e.map(e=>{const t=createItem({prefix:r.value,code:e.text});if(!checkCodeInList(e.text))return putSpinnet(r.closest("form"),"remove"),Swal.fire({title:"O Código duplicado",text:`O Código ${e.text} já está cadastrado em um item`,icon:"error",confirmButtonText:"Ok"});codesInsert.push({code:e.text,name:r.value}),changeBadgeForm(codesInsert.length),o.querySelector(".card-body > .row").append(t)}),putSpinnet(r.closest("form"),"remove")}).catch(e=>(putSpinnet(r.closest("form"),"remove"),Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"})))})})},readFile=e=>new Promise((t,o)=>{const r=document.body.dataset.token,n=new FormData;n.append("file",e);const{type:a}=e;if("text/plain"!=a)return o("O tipo de arquivo deve ser .txt"),Swal.fire({title:"O tipo de arquivo deve ser .txt",text:"Selecione um arquivo com extensão txt",icon:"error",confirmButtonText:"Ok"});fetch("/api/file",{method:"POST",headers:{authorization:`Bearer ${r}`},body:n}).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}),requestInsertProduct=e=>new Promise((t,o)=>{const{name:r,description:n,weight:a,brand:s,lot:c,type:i,excerpt:l,availability:d,items:u,image_id:m,categories:p}=e,y=document.body.dataset.token;if(!p.length)return o("Selecione ao menos 1 categoria");fetch("/api/product",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${y}`},body:JSON.stringify({name:r,description:n,weight:a,brand:s,lot:c,type:i,categories:p,availability:d,items:u,image_id:m})}).then(e=>e.json()).then(e=>e.error?o(e.error.replace(/(\r\n|\n|\r)/gm,"<br>")):(t(e),console.log(e))).catch(e=>o(e))}),productCreate=e=>{const t=e.querySelector(".productName"),o=e.querySelector(".productDescription"),r=e.querySelector(".productExcerpt"),n=e.querySelector(".productWeigth"),a=e.querySelector(".productBrand"),s=e.querySelector(".productLot"),c=e.querySelector(".productType"),i=e.querySelector(".productAvailability"),l=document.querySelector(".productItemName"),d=document.querySelector(".multCodes"),u=document.querySelector(".productCode"),m=document.querySelector(".fileToRead"),p=(imgProduct.images,document.querySelectorAll(".productCategory"));let y=[];if(p&&Array.from(p).forEach(e=>{e.checked&&y.push(parseInt(e.value))}),!y.length)return Swal.fire({title:"Selecione a categoria",text:"Por favor selecione ao menos 1 categoria",icon:"error",confirmButtonText:"Ok"});console.log("Categorias",y),e.classList.add("was-validated"),putSpinnet(e.closest("form"),"insert");const h=[t,n,a,s,c,i,l];return d.checked?h.push(m):h.push(u),formValidate(h).then(l=>{const{valids:d,invalids:u}=l;return u.length&&(putSpinnet(e.closest("form"),"remove"),u.forEach(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")})),codesInsert.length?(d.forEach(e=>{e.classList.remove("is-invalid"),e.classList.add("is-valid")}),imgProduct.create().then(l=>requestInsertProduct({name:t.value,description:o.value,excerpt:r.value,weight:n.value,brand:a.value,lot:s.value,type:c.value,availability:i.value,items:codesInsert,categories:y,image_id:l}).then(t=>{if(t.error){const o=document.createElement("div");o.classList.add("alert","alert-danger"),o.setAttribute("role","alert"),o.innerHTML=t.error,e.prepend(o),setTimeout(()=>{o.remove()},4e3)}const o=e.querySelectorAll("input, textarea, .is-valid");return document.querySelector(".imagesProductContainer").innerHTML="",e.classList.remove("was-validated"),Array.from(o).forEach(e=>(e.value="",e.classList.remove("is-valid"))),putSpinnet(e.closest("form"),"remove"),Swal.fire({title:"Produto cadastrado",text:`O produto ${t.name} foi cadastrado com sucesso`,icon:"success",confirmButtonText:"Ok"})}).catch(t=>{const o=document.createElement("div");o.classList.add("alert","alert-danger"),o.setAttribute("role","alert"),o.innerHTML=t,e.prepend(o),putSpinnet(e.closest("form"),"remove"),setTimeout(()=>{o.remove()},4e3)}))):(putSpinnet(e.closest("form"),"remove"),Swal.fire({title:"Nenhum item cadastrado",text:"Por favor ensira ao menos 1 item no produto",icon:"error",confirmButtonText:"Ok"}))}).catch(t=>{putSpinnet(e.closest("form"),"remove"),console.log(t)})},btnInsertProduct=document.querySelector(".btnInsertProduct");btnInsertProduct&&btnInsertProduct.addEventListener("click",e=>{e.preventDefault(),productCreate(btnInsertProduct.closest("form"))});const switchMultCodes=document.querySelector(".multCodes");switchMultCodes&&switchMultCodes.addEventListener("change",function(e){!0===switchMultCodes.checked?(document.querySelector(".form-items-codes .custom-file-wrapper").classList.add("show"),document.querySelector(".form-items-codes .singleCode").classList.add("hide"),document.querySelector(".btnInsertItemProduct").disabled=!0):(document.querySelector(".form-items-codes .custom-file-wrapper").classList.remove("show"),document.querySelector(".form-items-codes .singleCode").classList.remove("hide"),document.querySelector(".btnInsertItemProduct").disabled=!1)}),btnClearCodes=document.querySelector(".btnCleamListProduct"),btnClearCodes&&btnClearCodes.addEventListener("click",e=>(e.preventDefault(),clearListItems()));const inputFileProduct=document.querySelector(".fileToRead");inputFileProduct&&changeFileProduct(inputFileProduct);const btnInsertItemProduct=document.querySelector(".btnInsertItemProduct");btnInsertItemProduct&&insertSingleCode(btnInsertItemProduct);const ImageProduct=document.querySelector(".productImage");ImageProduct&&imgProduct.change(ImageProduct);const profile=(()=>{const e=e=>(console.log(e.files),(e=>new Promise((t,o)=>{const r=document.body.dataset.token,n=new FormData;n.append("file",e),fetch("/api/user/image",{method:"PUT",headers:{authorization:`Bearer ${r}`},body:n}).then(e=>e.json()).then(e=>t(e)).catch(e=>o(e))}))(e.files[0]).then(e=>e.error?console.log(e.error):(document.querySelector(".img-profile").src=e.url,document.querySelector(".profile-avatar").src=e.url)).catch(e=>console.log(e))),t=e=>{if(!e)return console.log("Formulário não existe");Array.from(e.elements);const t={name:e.querySelector("#input-username").value,email:e.querySelector("#input-email").value,currentPassword:e.querySelector("#input-current-password").value,newPassword:e.querySelector("#input-new-password").value,address:e.querySelector("#input-address").value,city:e.querySelector("#input-city").value,phone:e.querySelector("#input-phone").value,cell:e.querySelector("#input-cell").value,about:e.querySelector("#textarea-about").value};return(e=>new Promise((t,o)=>{const r=document.body.dataset.token,{name:n,email:a,phone:s,cell:c,currentPassword:i,newPassword:l,address:d,about:u,city:m}=e;fetch("/api/user",{method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${r}`},body:JSON.stringify({name:n,email:a,phone:s,cell:c,currentPassword:i,newPassword:l,address:d,about:u,city:m})}).then(e=>e.json()).then(e=>t(e)).catch(e=>o(e))}))(t).then(e=>e.error?Swal.fire({title:"Erro ao atualizar usuário",text:e.error,icon:"error",confirmButtonText:"Ok"}):Swal.fire({title:"Perfil atualizado",text:`O Usuário ${e.name} foi atualizado com sucesso!`,icon:"success",confirmButtonText:"Ok"})).catch(e=>Swal.fire({title:"Erro ao atualizar usuário",text:e,icon:"error",confirmButtonText:"Ok"}))};return{edit:t=>{t.addEventListener("change",function(o){e(t)})},enableEdit:e=>{e||console.log("Botão não existe"),e.addEventListener("click",o=>{o.preventDefault();const r=document.querySelectorAll(".formEditUser input, .formEditUser textarea"),n=document.querySelector(".formEditUser");return e.classList.contains("save")?(Array.from(r).forEach(e=>{e.disabled=!0}),e.innerHTML="Edit profile",n&&t(n),e.classList.remove("save")):(Array.from(r).forEach(e=>{e.disabled=!1}),e.innerHTML="Salvar alterações",e.classList.add("save"))})},save:t}})(),inputEditAvatar=document.querySelector(".inputProfileAvatar");inputEditAvatar&&profile.edit(inputEditAvatar);const btnEditUser=document.querySelector(".btnEditUser");btnEditUser&&profile.enableEdit(btnEditUser);const search=(()=>{const e=e=>new Promise((t,o)=>{const{name:r,surname:n,email:a,code:s}=e;fetch("/api/search",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:r,surname:n,email:a,code:s,ip:ip,city:city,region:region})}).then(e=>e.json()).then(e=>(console.log(e),e.error?o(e.error):t(e))).catch(e=>o(e))});return{search:t=>{t.addEventListener("click",t=>{t.preventDefault(),console.log();const o=document.querySelector("input.Code"),r=document.querySelector("input.name"),n=document.querySelector("input.surname"),a=document.querySelector("input.mail");if(r&&n&&a)return(e=>new Promise((t,o)=>{e.map(e=>{const{input:r,msg:n}=e;return r.value?t():(r.setCustomValidity(n),r.reportValidity(),o(n))})}))([{input:r,msg:"Informe seu nome"},{input:n,msg:"Informe seu sobrenome"},{input:a,msg:"Informe seu e-mail"}]).then(t=>e({code:o.value,name:r.value,surname:n.value,email:a.value}).then(e=>{const{device:t,code:o,ip:r,city:n,address:a}=e;return document.querySelector(".clientInfo").innerHTML=`\n                            <p>\n                                <strong>Código: </strong> ${o.code}\n                            </p>\n                            <p>\n                                <strong>Produto: </strong> ${o.product.name}\n                            </p>\n                            <p>\n                                <strong>Item: </strong> ${o.item.name}\n                            </p>\n                            <p>\n                                <strong>Device: </strong> ${t}\n                            </p>\n                            <p>\n                                <strong>Cidade: </strong> ${n}\n                            </p>\n                            <p>\n                                <strong>Estado: </strong> ${a}\n                            </p>\n                            <p>\n                                <strong>Endereço IP: </strong> ${r}\n                            </p>\n                        `}).catch(e=>Swal.fire({title:e,icon:"error",confirmButtonText:"Ok"}))).catch(e=>console.log(e))})},show:e=>{e.addEventListener("click",t=>(t.preventDefault(),(e=>new Promise((t,o)=>{const r=document.body.dataset.token;fetch(`/api/search/${e}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${r}`}}).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}))(e.dataset.id).then(e=>{const t=new Intl.DateTimeFormat("pt-BR").format(new Date(e.createdAt));document.querySelector(".consultId").innerHTML=e.id,document.querySelector(".consultName").innerHTML=e.name,document.querySelector(".consultSurname").innerHTML=e.surname,document.querySelector(".consultMail").innerHTML=e.email,document.querySelector(".consultCity").innerHTML=e.city,document.querySelector(".consultAddress").innerHTML=e.address,document.querySelector(".consultCode").innerHTML=e.code.code,document.querySelector(".consultIp").innerHTML=e.ip,document.querySelector(".constData").innerHTML=t,$("#modalShowConsult").modal("show")})))}}})(),consults=document.querySelectorAll(".listConsults > tr");consults&&Array.from(consults).forEach(e=>{search.show(e)}),$(".page-adm-consults #dataTable").on("draw.dt",function(){const e=document.querySelectorAll(".listConsults > tr");e&&Array.from(e).forEach(e=>{search.show(e)})});const btnSearchCode=document.querySelector(".submitSearch");btnSearchCode&&search.search(btnSearchCode);const userResource="user",user={forgot:e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector("#input-forgot-email");t&&(e=>new Promise((t,o)=>{fetch("/api/forgot",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:e})}).then(e=>e.json()).then(e=>t(e)).catch(e=>o(e))}))(t.value).then(e=>e.erro?alert(e.erro):window.location.href="/login").catch(e=>console.log(e))})}},btnForgot=document.querySelector(".btnForgot");btnForgot&&user.forgot(btnForgot);const requestInsertAvatar=e=>new Promise((t,o)=>{const r=document.body.dataset.token,n=new FormData;n.append("file",e);fetch("/api/user/image",{method:"POST",headers:{authorization:`Bearer ${r}`},body:n}).then(e=>e.json()).then(e=>(console.log(e),t(e)))}),requestInsertUser=e=>new Promise((t,o)=>{const{name:r,email:n,password:a,phone:s,cell:c,type:i,image_id:l}=e,d=document.body.dataset.token;fetch("/api/user",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${d}`},body:JSON.stringify({name:r,email:n,password:a,phone:s,cell:c,type:i,image_id:l})}).then(e=>e.json()).then(e=>e.error?o(e.error):(t(e),console.log(e))).catch(e=>o(e))}),userCreate=e=>{const t=e.querySelector("input.userName"),o=e.querySelector(".userMail"),r=e.querySelector(".userPhone"),n=e.querySelector(".userCell"),a=e.querySelector(".userType"),s=e.querySelector(".userPassword"),c=e.querySelector(".inputUserImage");return e.classList.add("was-validated"),t.value?(t.classList.remove("is-invalid"),t.classList.add("is-valid"),o.value?(o.classList.remove("is-invalid"),o.classList.add("is-valid"),r.value?(r.classList.remove("is-invalid"),r.classList.add("is-valid"),n.value?(n.classList.remove("is-invalid"),n.classList.add("is-valid"),s.value?(s.classList.remove("is-invalid"),s.classList.add("is-valid"),a.value?(a.classList.remove("is-invalid"),a.classList.add("is-valid"),requestInsertUser({name:t.value,email:o.value,phone:r.value,cell:n.value,type:a.value,password:s.value,image_id:c.value}).then(t=>{if(t.error){const o=document.createElement("div");o.classList.add("alert","alert-danger"),o.setAttribute("role","alert"),o.innerHTML=t.error,e.prepend(o),setTimeout(()=>{o.remove()},4e3)}const o=e.querySelectorAll("input, textarea, .is-valid");return e.classList.remove("was-validated"),Array.from(o).forEach(e=>(e.value="",e.classList.remove("is-valid"))),alert(`Usuário ${t.name} cadastrado!`)}).catch(t=>{const o=document.createElement("div");o.classList.add("alert","alert-danger"),o.setAttribute("role","alert"),o.innerHTML=t,e.prepend(o),setTimeout(()=>{o.remove()},4e3)})):a.classList.add("is-invalid")):s.classList.add("is-invalid")):n.classList.add("is-invalid")):r.classList.add("is-invalid")):o.classList.add("is-invalid")):t.classList.add("is-invalid")},inputImageUser=document.querySelector(".userFile");inputImageUser&&inputImageUser.addEventListener("change",e=>(console.log(inputImageUser.files[0]),requestInsertAvatar(inputImageUser.files[0]).then(e=>{document.querySelector(".insertUserAvatar").setAttribute("src",e.url),document.querySelector(".inputUserImage").value=e.id})));const btnInsertUser=document.querySelector(".btnCreateUser");btnInsertUser&&btnInsertUser.addEventListener("click",e=>{e.preventDefault(),userCreate(btnInsertUser.closest("form"))});const contact={create:e=>{e.addEventListener("submit",t=>{if(t.preventDefault(),e.checkValidity())return(e=>new Promise((t,o)=>{const{url:r,method:n,body:a,headers:s}=e,c={method:n||"GET",headers:{"content-type":s["content-type"]||null}};a&&(c.body=JSON.stringify(a)),console.log("Options request: ",c),fetch(r,c).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}))({url:"/api/contact",method:"POST",headers:{"content-type":"application/json"},body:{fullname:e.querySelector(".contactFullName").value,email:e.querySelector(".contactMail").value,subject:e.querySelector(".contactSubject").value,message:e.querySelector(".contactMessage").value}}).then(t=>{const o=[...e.elements];return e.classList.remove("was-validated"),o.map(e=>{e.value=""}),Swal.fire({title:"Sucesso!",text:`Foi solicitado um contato para ${t.email}`,icon:"success",confirmButtonText:"Ok"})}).catch(e=>(console.log(e),Swal.fire({title:"Erro!",text:e,icon:"error",confirmButtonText:"Ok"})))})}},formContact=document.querySelector(".form-contact");formContact&&contact.create(formContact);const consult=(()=>{const e=()=>new Promise((e,t)=>{fetch("https://ipapi.co/json/",{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.ok?e.json():t("Erro ao pesquisar codigo")).then(t=>e(t)).catch(e=>t(e))}),t=e=>new Promise((t,o)=>{const{email:r,code:n,ip:a,city:s,region:c}=e;fetch("/api/search",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:r,code:n,ip:a,city:s,region:c})}).then(e=>204===e.status?o({error:"Não encontrado",status:204}):e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>o(e))}),o=e=>{const t={};return new Promise((o,r)=>(e.map(e=>{const{input:o,msg:n}=e;if("BUTTON"!=o.tagName&&(!o.value||"Selecione..."==o.value))return o.setCustomValidity(n),o.reportValidity(),r(n);o.classList.contains("consultMail")&&(t.email=o.value),o.classList.contains("consultCode")&&(t.code=o.value)}),o(t)))};return{consult:r=>{r.addEventListener("submit",function(n){n.preventDefault();const a=Array.from(r.elements).map(e=>({input:e,msg:"Por favor preencha este campo"})),s=document.querySelector(".barCode");return o(a).then(o=>e().then(e=>{const{ip:n,city:a,region:c}=e;return t({code:o.code,ip:n,city:a,region:c,email:o.email}).then(e=>(s.innerHTML=e.code.code,$("#modalConsult").modal("show"),Array.from(r.elements).map(e=>{"BUTTON"!=e.tagName&&(e.value="")}))).catch(e=>{if(e.status)return s.innerHTML=o.code,$("#modalConsultError").modal("show");$("#modalErrValidation").modal("show")})}).catch(e=>Swal.fire({title:"Erro ao coletar informações se segurança",icon:"error",confirmButtonText:"Ok"}))).catch(e=>{console.log(e)})})}}})(),mobileMenu={dropdown:e=>{e.addEventListener("click",function(t){t.preventDefault(),console.log("cliquei"),e.closest("li").querySelector(".dropdown-menu").classList.toggle("show")})}},mobilteToggle=document.querySelectorAll("li > a.dropdown-toggle");Array.from(mobilteToggle).forEach(e=>{e&&mobileMenu.dropdown(e)});const overlay=document.querySelector(".mobile-back");overlay&&overlay.addEventListener("click",function(e){const t=document.querySelectorAll(".show");Array.from(t).forEach(e=>{e.classList.remove("show")})});const formConsultCode=document.querySelector(".formValidateCode");formConsultCode&&consult.consult(formConsultCode);